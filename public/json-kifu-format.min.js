/*! For license information please see json-kifu-format.min.js.LICENSE.txt */
var JSONKifuFormat;(()=>{var t={405:t=>{"use strict";function r(t,e,o,n){this.message=t,this.expected=e,this.found=o,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,r)}!function(t,r){function e(){this.constructor=t}e.prototype=r.prototype,t.prototype=new e}(r,Error),r.buildMessage=function(t,r){var e={literal:function(t){return'"'+n(t.text)+'"'},class:function(t){var r,e="";for(r=0;r<t.parts.length;r++)e+=t.parts[r]instanceof Array?i(t.parts[r][0])+"-"+i(t.parts[r][1]):i(t.parts[r]);return"["+(t.inverted?"^":"")+e+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function o(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+o(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+o(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+o(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+o(t)}))}return"Expected "+function(t){var r,o,n,i=new Array(t.length);for(r=0;r<t.length;r++)i[r]=(n=t[r],e[n.type](n));if(i.sort(),i.length>0){for(r=1,o=1;r<i.length;r++)i[r-1]!==i[r]&&(i[o]=i[r],o++);i.length=o}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+n(t)+'"':"end of input"}(r)+" found."},t.exports={SyntaxError:r,parse:function(t,e){e=void 0!==e?e:{};var o,n,i,u,a={},s={kifu:$},c=$,l=D("V2",!1),f=D(".1",!1),h=D(".2",!1),d=D("$",!1),p=/^[^:]/,v=z([":"],!0,!1),m=D(":",!1),g=D("N+",!1),A=D("N-",!1),k=D("PI",!1),y=D("P",!1),I=/^[1-9]/,K=z([["1","9"]],!1,!1),C=D(" * ",!1),F=D("%",!1),x=/^[\-+_A-Z]/,E=z(["-","+","_",["A","Z"]],!1,!1),U=D("+",!1),b=D("-",!1),w=D("'",!1),M=D("T",!1),O=/^[0-9]/,S=z([["0","9"]],!1,!1),T=/^[A-Z]/,N=z([["A","Z"]],!1,!1),H=D("\r",!1),R=D("\n",!1),G=D(" ",!1),P=D(",",!1),_=/^[^\r\n]/,Y=z(["\r","\n"],!0,!1),B=0,L=[{line:1,column:1}],j=0,W=[];if("startRule"in e){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');c=s[e.startRule]}function D(t,r){return{type:"literal",text:t,ignoreCase:r}}function z(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function J(r){var e,o=L[r];if(o)return o;for(e=r-1;!L[e];)e--;for(o={line:(o=L[e]).line,column:o.column};e<r;)10===t.charCodeAt(e)?(o.line++,o.column=1):o.column++,e++;return L[r]=o,o}function V(t,r){var e=J(t),o=J(r);return{start:{offset:t,line:e.line,column:e.column},end:{offset:r,line:o.line,column:o.column}}}function Z(t){B<j||(B>j&&(j=B,W=[]),W.push(t))}function $(){var r;return(r=function(){var r,e,o,n,i,u,s,c,d;return r=B,e=function(){var r,e,o,n,i;for(r=B,e=[],o=ut();o!==a;)e.push(o),o=ut();return e!==a?("V2"===t.substr(B,2)?(o="V2",B+=2):(o=a,Z(l)),o!==a?(".1"===t.substr(B,2)?(n=".1",B+=2):(n=a,Z(f)),n===a&&(".2"===t.substr(B,2)?(n=".2",B+=2):(n=a,Z(h))),n===a&&(n=null),n!==a&&(i=lt())!==a?r=e=[e,o,n,i]:(B=r,r=a)):(B=r,r=a)):(B=r,r=a),r}(),e!==a?(o=function(){var t,r,e;return t=B,(r=Q())===a&&(r=null),r!==a?(e=function(){var t,r;for(B,t=[],r=q();r!==a;)t.push(r),r=q();return t!==a&&(t=function(t){for(var r,e={},o=0;o<t.length;o++)e[(r=t[o].k,{EVENT:"棋戦",SITE:"場所",START_TIME:"開始日時",END_TIME:"終了日時",TIME_LIMIT:"持ち時間"}[r]||r)]=t[o].v;return e}(t)),t}(),e!==a?t=r={players:r,header:e}:(B=t,t=a)):(B=t,t=a),t}(),o===a&&(o=null),o!==a&&(n=X())!==a?((i=ot())===a&&(i=null),i!==a?(s=n,c=i,d={header:(u=o).header,initial:s,moves:c},u&&u.players&&(u.players[0]&&(d.header["先手"]=u.players[0]),u.players[1]&&(d.header["後手"]=u.players[1])),r=e=d):(B=r,r=a)):(B=r,r=a)):(B=r,r=a),r}())===a&&(r=function(){var t,r,e,o,n,i;return t=B,(r=Q())===a&&(r=null),r!==a?((e=X())===a&&(e=null),e!==a&&(o=ot())!==a?(i={header:{},initial:e,moves:o},(n=r)&&(n[0]&&(i.header["先手"]=n[0]),n[1]&&(i.header["後手"]=n[1])),t=r=i):(B=t,t=a)):(B=t,t=a),t}()),r}function q(){var r,e,o,n,i,u,s,c;for(r=B,e=[],o=ut();o!==a;)e.push(o),o=ut();if(e!==a)if(36===t.charCodeAt(B)?(o="$",B++):(o=a,Z(d)),o!==a){if(n=[],p.test(t.charAt(B))?(i=t.charAt(B),B++):(i=a,Z(v)),i!==a)for(;i!==a;)n.push(i),p.test(t.charAt(B))?(i=t.charAt(B),B++):(i=a,Z(v));else n=a;if(n!==a)if(58===t.charCodeAt(B)?(i=":",B++):(i=a,Z(m)),i!==a){for(u=[],s=ft();s!==a;)u.push(s),s=ft();u!==a&&(s=lt())!==a?(c=u,r=e={k:n.join(""),v:c.join("")}):(B=r,r=a)}else B=r,r=a;else B=r,r=a}else B=r,r=a;else B=r,r=a;return r}function Q(){var r,e,o,n,i,u,s,c,l,f;for(r=B,e=[],o=ut();o!==a;)e.push(o),o=ut();if(e!==a){if(o=B,"N+"===t.substr(B,2)?(n="N+",B+=2):(n=a,Z(g)),n!==a){for(i=[],u=ft();u!==a;)i.push(u),u=ft();i!==a&&(u=lt())!==a?o=n=i:(B=o,o=a)}else B=o,o=a;if(o===a&&(o=null),o!==a){for(n=[],i=ut();i!==a;)n.push(i),i=ut();if(n!==a){if(i=B,"N-"===t.substr(B,2)?(u="N-",B+=2):(u=a,Z(A)),u!==a){for(s=[],c=ft();c!==a;)s.push(c),c=ft();s!==a&&(c=lt())!==a?i=u=s:(B=i,i=a)}else B=i,i=a;i===a&&(i=null),i!==a?(f=i,r=e=[(l=o)?l.join(""):null,f?f.join(""):null]):(B=r,r=a)}else B=r,r=a}else B=r,r=a}else B=r,r=a;return r}function X(){var r,e,o,n,i,u,s,c,l;for(r=B,e=[],o=ut();o!==a;)e.push(o),o=ut();if(e!==a)if(o=function(){var r,e,o,n;if(r=B,"PI"===t.substr(B,2)?(e="PI",B+=2):(e=a,Z(k)),e!==a){for(o=[],n=ct();n!==a;)o.push(n),n=ct();o!==a&&(n=lt())!==a?r=e=function(t){for(var r={preset:"OTHER",data:{board:[[{color:1,kind:"KY"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KY"}],[{color:1,kind:"KE"},{color:1,kind:"KA"},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{color:0,kind:"HI"},{color:0,kind:"KE"}],[{color:1,kind:"GI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"GI"}],[{color:1,kind:"KI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KI"}],[{color:1,kind:"OU"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"OU"}],[{color:1,kind:"KI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KI"}],[{color:1,kind:"GI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"GI"}],[{color:1,kind:"KE"},{color:1,kind:"HI"},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{color:0,kind:"KA"},{color:0,kind:"KE"}],[{color:1,kind:"KY"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KY"}]]}},e=0;e<t.length;e++)r.data.board[t[e].xy.x-1][t[e].xy.y-1]={};return r}(o):(B=r,r=a)}else B=r,r=a;return r}(),o===a&&(o=function(){var t,r;if(B,t=[],(r=tt())!==a)for(;r!==a;)t.push(r),r=tt();else t=a;return t!==a&&(t=function(t){for(var r=[],e=0;e<9;e++){for(var o=[],n=0;n<9;n++)o.push(t[n][8-e]);r.push(o)}return{preset:"OTHER",data:{board:r}}}(t)),t}(),o===a&&(o=B,(n="")!==a&&(n="NO"),o=n)),o!==a)if(n=function(){var t,r;for(B,t=[],r=et();r!==a;)t.push(r),r=et();return t!==a&&(t=function(t){for(var r=[],e=[{FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0},{FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0}],o={FU:18,KY:4,KE:4,GI:4,KI:4,KA:2,HI:2},n=0;n<9;n++){for(var i=[],u=0;u<9;u++)i.push({});r.push(i)}t:for(n=0;n<t.length;n++)for(u=0;u<t[n].pieces.length;u++){var a=t[n].pieces[u];if(0==a.xy.x){if("AL"==a.piece){e[t[n].teban]=o;break t}e[t[n].teban][a.piece]++}else r[a.xy.x-1][a.xy.y-1]={color:t[n].teban,kind:a.piece};"OU"!=a.piece&&o[a.piece]--}return{preset:"OTHER",data:{board:r,hands:e}}}(t)),t}(),n!==a){for(i=[],u=ut();u!==a;)i.push(u),u=ut();i!==a&&(u=it())!==a&&lt()!==a?(c=n,l=u,"NO"==(s=o)?s=c:s.data.hands=c.data.hands,s.data.color=l,r=e=s):(B=r,r=a)}else B=r,r=a;else B=r,r=a;else B=r,r=a;return r}function tt(){var r,e,o,n,i;if(r=B,80===t.charCodeAt(B)?(e="P",B++):(e=a,Z(y)),e!==a)if(I.test(t.charAt(B))?(o=t.charAt(B),B++):(o=a,Z(K)),o!==a){if(n=[],(i=rt())!==a)for(;i!==a;)n.push(i),i=rt();else n=a;n!==a&&(i=lt())!==a?r=e=n:(B=r,r=a)}else B=r,r=a;else B=r,r=a;return r}function rt(){var r,e,o;return r=B,(e=it())!==a&&(o=st())!==a?r=e={color:e,kind:o}:(B=r,r=a),r===a&&(r=B," * "===t.substr(B,3)?(e=" * ",B+=3):(e=a,Z(C)),e!==a&&(e={}),r=e),r}function et(){var r,e,o,n,i;if(r=B,80===t.charCodeAt(B)?(e="P",B++):(e=a,Z(y)),e!==a)if((o=it())!==a){for(n=[],i=ct();i!==a;)n.push(i),i=ct();n!==a&&(i=lt())!==a?r=e={teban:o,pieces:n}:(B=r,r=a)}else B=r,r=a;else B=r,r=a;return r}function ot(){var t,r,e,o,n,i,u;if(t=B,r=function(){var t,r,e;for(B,t=[],r=ut();r!==a;)t.push(r),r=ut();return t!==a&&(t=(e=t).length>0?{comments:e}:{}),t}(),r!==a){for(e=[],o=nt();o!==a;)e.push(o),o=nt();if(e!==a){for(o=[],n=ut();n!==a;)o.push(n),n=ut();o!==a?(i=r,(u=e).unshift(i),t=r=u):(B=t,t=a)}else B=t,t=a}else B=t,t=a;return t}function nt(){var r,e,o,n,i,u;if(r=B,e=function(){var t,r,e,o,n,i;return t=B,it()!==a&&(r=at())!==a&&(e=at())!==a&&(o=st())!==a&&lt()!==a?(i={to:e,piece:o},0!=(n=r).x&&(i.from=n),t=i):(B=t,t=a),t}(),e===a&&(e=function(){var r,e,o,n;if(r=B,37===t.charCodeAt(B)?(e="%",B++):(e=a,Z(F)),e!==a){if(o=[],x.test(t.charAt(B))?(n=t.charAt(B),B++):(n=a,Z(E)),n!==a)for(;n!==a;)o.push(n),x.test(t.charAt(B))?(n=t.charAt(B),B++):(n=a,Z(E));else o=a;o!==a&&(n=lt())!==a?r=e={special:o.join("")}:(B=r,r=a)}else B=r,r=a;return r}()),e!==a){for(o=[],n=ut();n!==a;)o.push(n),n=ut();if(o!==a)if(n=function(){var r,e,o,n,i,u;if(r=B,84===t.charCodeAt(B)?(e="T",B++):(e=a,Z(M)),e!==a){for(o=[],O.test(t.charAt(B))?(n=t.charAt(B),B++):(n=a,Z(S));n!==a;)o.push(n),O.test(t.charAt(B))?(n=t.charAt(B),B++):(n=a,Z(S));o!==a&&(n=lt())!==a?r=e={now:(i=parseInt(o.join("")),u=i%60,{m:(i-u)/60,s:u})}:(B=r,r=a)}else B=r,r=a;return r}(),n===a&&(n=null),n!==a){for(i=[],u=ut();u!==a;)i.push(u),u=ut();i!==a?r=e=function(t,r,e,o){var n={};const i=r.concat(o);return i.length>0&&(n.comments=i),e&&(n.time=e),t.special?n.special=t.special:n.move=t,n}(e,o,n,i):(B=r,r=a)}else B=r,r=a;else B=r,r=a}else B=r,r=a;return r}function it(){var r,e;return r=B,43===t.charCodeAt(B)?(e="+",B++):(e=a,Z(U)),e!==a&&(e=0),(r=e)===a&&(r=B,45===t.charCodeAt(B)?(e="-",B++):(e=a,Z(b)),e!==a&&(e=1),r=e),r}function ut(){var r,e,o,n;if(r=B,39===t.charCodeAt(B)?(e="'",B++):(e=a,Z(w)),e!==a){for(o=[],n=ft();n!==a;)o.push(n),n=ft();o!==a&&(n=lt())!==a?r=e=o.join(""):(B=r,r=a)}else B=r,r=a;return r}function at(){var r,e,o,n;return r=B,O.test(t.charAt(B))?(e=t.charAt(B),B++):(e=a,Z(S)),e!==a?(O.test(t.charAt(B))?(o=t.charAt(B),B++):(o=a,Z(S)),o!==a?(n=o,r=e={x:parseInt(e),y:parseInt(n)}):(B=r,r=a)):(B=r,r=a),r}function st(){var r,e,o;return r=B,T.test(t.charAt(B))?(e=t.charAt(B),B++):(e=a,Z(N)),e!==a?(T.test(t.charAt(B))?(o=t.charAt(B),B++):(o=a,Z(N)),o!==a?r=e+=o:(B=r,r=a)):(B=r,r=a),r}function ct(){var t,r,e;return t=B,(r=at())!==a&&(e=st())!==a?t=r={xy:r,piece:e}:(B=t,t=a),t}function lt(){var r,e,o;if(r=B,13===t.charCodeAt(B)?(e="\r",B++):(e=a,Z(H)),e===a&&(e=null),e!==a?(10===t.charCodeAt(B)?(o="\n",B++):(o=a,Z(R)),o!==a?r=e=[e,o]:(B=r,r=a)):(B=r,r=a),r===a){for(r=B,e=[],32===t.charCodeAt(B)?(o=" ",B++):(o=a,Z(G));o!==a;)e.push(o),32===t.charCodeAt(B)?(o=" ",B++):(o=a,Z(G));e!==a?(44===t.charCodeAt(B)?(o=",",B++):(o=a,Z(P)),o!==a?r=e=[e,o]:(B=r,r=a)):(B=r,r=a)}return r}function ft(){var r;return _.test(t.charAt(B))?(r=t.charAt(B),B++):(r=a,Z(Y)),r}if((o=c())!==a&&B===t.length)return o;throw o!==a&&B<t.length&&Z({type:"end"}),n=W,i=j<t.length?t.charAt(j):null,u=j<t.length?V(j,j+1):V(j,j),new r(r.buildMessage(n,i),n,i,u)}}},478:t=>{"use strict";function r(t,e,o,n){this.message=t,this.expected=e,this.found=o,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,r)}!function(t,r){function e(){this.constructor=t}e.prototype=r.prototype,t.prototype=new e}(r,Error),r.buildMessage=function(t,r){var e={literal:function(t){return'"'+n(t.text)+'"'},class:function(t){var r,e="";for(r=0;r<t.parts.length;r++)e+=t.parts[r]instanceof Array?i(t.parts[r][0])+"-"+i(t.parts[r][1]):i(t.parts[r]);return"["+(t.inverted?"^":"")+e+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function o(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+o(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+o(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+o(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+o(t)}))}return"Expected "+function(t){var r,o,n,i=new Array(t.length);for(r=0;r<t.length;r++)i[r]=(n=t[r],e[n.type](n));if(i.sort(),i.length>0){for(r=1,o=1;r<i.length;r++)i[r-1]!==i[r]&&(i[o]=i[r],o++);i.length=o}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+n(t)+'"':"end of input"}(r)+" found."},t.exports={SyntaxError:r,parse:function(t,e){e=void 0!==e?e:{};var o,n,i,u,a={},s={kifu:bt},c=bt,l=/^[^\uFF1A\r\n]/,f=Ft(["：","\r","\n"],!0,!1),h=Ct("：",!1),d=/^[\u5148\u5F8C\u4E0A\u4E0B]/,p=Ft(["先","後","上","下"],!1,!1),v=Ct("手番",!1),m=" ",g=Ct(" ",!1),A=Ct("+",!1),k=Ct("|",!1),y=Ct(" ・",!1),I=Ct("^",!1),K=Ct("v",!1),C=Ct("V",!1),F=Ct("&",!1),x=/^[\u25B2\u25B3]/,E=Ft(["▲","△"],!1,!1),U=Ct("成",!1),b=Ct("不成",!1),w=Ct("打",!1),M=Ct("同",!1),O=Ct("　",!1),S=/^[\u6B69\u9999\u6842\u9280\u91D1\u89D2\u98DB\u738B\u7389\u3068\u674F\u572D\u5168\u99AC\u7ADC\u9F8D]/,T=Ft(["歩","香","桂","銀","金","角","飛","王","玉","と","杏","圭","全","馬","竜","龍"],!1,!1),N=/^[\u5DE6\u76F4\u53F3]/,H=Ft(["左","直","右"],!1,!1),R=/^[\u4E0A\u5BC4\u5F15]/,G=Ft(["上","寄","引"],!1,!1),P=/^[\uFF11\uFF12\uFF13\uFF14\uFF15\uFF16\uFF17\uFF18\uFF19]/,_=Ft(["１","２","３","４","５","６","７","８","９"],!1,!1),Y=/^[\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D]/,B=Ft(["一","二","三","四","五","六","七","八","九"],!1,!1),L=Ct("*",!1),j=Ct("まで",!1),W=/^[0-9]/,D=Ft([["0","9"]],!1,!1),z=Ct("手",!1),J=Ct("で",!1),V=Ct("手の",!1),Z="勝ち",$=Ct("勝ち",!1),q=Ct("反則",!1),Q=Ct("負け",!1),X=function(t,r){return r},tt="で時間切れにより",rt=Ct("で時間切れにより",!1),et="手の勝ち",ot=Ct("手の勝ち",!1),nt=Ct("で中断",!1),it="で持将棋",ut=Ct("で持将棋",!1),at="で千日手",st=Ct("で千日手",!1),ct=Ct("詰",!1),lt=Ct("み",!1),ft=Ct("で不詰",!1),ht=Ct("変化：",!1),dt=Ct("#",!1),pt=Ct("\t",!1),vt=Ct("\n",!1),mt=Ct("\r",!1),gt=/^[^\r\n]/,At=Ft(["\r","\n"],!0,!1),kt=0,yt=[{line:1,column:1}],It=0,Kt=[];if("startRule"in e){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');c=s[e.startRule]}function Ct(t,r){return{type:"literal",text:t,ignoreCase:r}}function Ft(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function xt(r){var e,o=yt[r];if(o)return o;for(e=r-1;!yt[e];)e--;for(o={line:(o=yt[e]).line,column:o.column};e<r;)10===t.charCodeAt(e)?(o.line++,o.column=1):o.column++,e++;return yt[r]=o,o}function Et(t,r){var e=xt(t),o=xt(r);return{start:{offset:t,line:e.line,column:e.column},end:{offset:r,line:o.line,column:o.column}}}function Ut(t){kt<It||(kt>It&&(It=kt,Kt=[]),Kt.push(t))}function bt(){var r,e,o,n,i,u,s;for(r=kt,e=[],o=wt();o!==a;)e.push(o),o=wt();if(e!==a)if(o=function(){var r,e,o,n,i,u,s,c;if(r=kt,e=kt,32===t.charCodeAt(kt)?(o=m,kt++):(o=a,Ut(g)),o!==a){for(n=[],i=jt();i!==a;)n.push(i),i=jt();n!==a&&(i=_t())!==a?e=o=[o,n,i]:(kt=e,e=a)}else kt=e,e=a;if(e===a&&(e=null),e!==a){if(o=kt,43===t.charCodeAt(kt)?(n="+",kt++):(n=a,Ut(A)),n!==a){for(i=[],u=jt();u!==a;)i.push(u),u=jt();i!==a&&(u=_t())!==a?o=n=[n,i,u]:(kt=o,o=a)}else kt=o,o=a;if(o===a&&(o=null),o!==a){if(n=[],(i=Mt())!==a)for(;i!==a;)n.push(i),i=Mt();else n=a;if(n!==a){if(i=kt,43===t.charCodeAt(kt)?(u="+",kt++):(u=a,Ut(A)),u!==a){for(s=[],c=jt();c!==a;)s.push(c),c=jt();s!==a&&(c=_t())!==a?i=u=[u,s,c]:(kt=i,i=a)}else kt=i,i=a;i===a&&(i=null),i!==a?r=e=function(t){for(var r=[],e=0;e<9;e++){for(var o=[],n=0;n<9;n++)o.push(t[n][8-e]);r.push(o)}return{preset:"OTHER",data:{board:r}}}(n):(kt=r,r=a)}else kt=r,r=a}else kt=r,r=a}else kt=r,r=a;return r}(),o===a&&(o=null),o!==a){for(n=[],i=wt();i!==a;)n.push(i),i=wt();if(n!==a)if((i=St())!==a){for(u=[],s=Gt();s!==a;)u.push(s),s=Gt();u!==a?r=e=function(t,r,e,o,n){for(var i={header:{},moves:o},u=0;u<t.length;u++)i.header[t[u].k]=t[u].v;for(u=0;u<e.length;u++)i.header[e[u].k]=e[u].v;if(r)i.initial=r;else if(i.header["手合割"]){var a=function(t){return{平手:"HIRATE",香落ち:"KY",右香落ち:"KY_R",角落ち:"KA",飛車落ち:"HI",飛香落ち:"HIKY",二枚落ち:"2",三枚落ち:"3",四枚落ち:"4",五枚落ち:"5",左五枚落ち:"5_L",六枚落ち:"6",左七枚落ち:"7_L",右七枚落ち:"7_R",八枚落ち:"8",十枚落ち:"10",その他:"OTHER"}[t.replace(/\s/g,"")]}(i.header["手合割"]);"OTHER"!=a&&(i.initial={preset:a})}i.initial&&i.initial.data&&(i.header["手番"]?(i.initial.data.color="下先".indexOf(i.header["手番"])>=0?0:1,delete i.header["手番"]):i.initial.data.color=0,i.initial.data.hands=[zt(i.header["先手の持駒"]||i.header["下手の持駒"]),zt(i.header["後手の持駒"]||i.header["上手の持駒"])],delete i.header["先手の持駒"],delete i.header["下手の持駒"],delete i.header["後手の持駒"],delete i.header["上手の持駒"]);var s=[{te:0,moves:o}];for(u=0;u<n.length;u++){for(var c=n[u],l=s.pop();l.te>=c.te;)l=s.pop();var f=l.moves[c.te-l.te];f.forks=f.forks||[],f.forks.push(c.moves),s.push(l),s.push(c)}return i}(e,o,n,i,u):(kt=r,r=a)}else kt=r,r=a;else kt=r,r=a}else kt=r,r=a;else kt=r,r=a;return r}function wt(){var r,e,o,n,i,u,s;if(r=kt,e=[],l.test(t.charAt(kt))?(o=t.charAt(kt),kt++):(o=a,Ut(f)),o!==a)for(;o!==a;)e.push(o),l.test(t.charAt(kt))?(o=t.charAt(kt),kt++):(o=a,Ut(f));else e=a;if(e!==a)if(65306===t.charCodeAt(kt)?(o="：",kt++):(o=a,Ut(h)),o!==a){for(n=[],i=jt();i!==a;)n.push(i),i=jt();if(n!==a){if(i=[],(u=_t())!==a)for(;u!==a;)i.push(u),u=_t();else i=a;i!==a?(s=n,r=e={k:e.join(""),v:s.join("")}):(kt=r,r=a)}else kt=r,r=a}else kt=r,r=a;else kt=r,r=a;return r===a&&(r=kt,d.test(t.charAt(kt))?(e=t.charAt(kt),kt++):(e=a,Ut(p)),e!==a?("手番"===t.substr(kt,2)?(o="手番",kt+=2):(o=a,Ut(v)),o!==a&&(n=_t())!==a?r=e={k:"手番",v:e}:(kt=r,r=a)):(kt=r,r=a)),r}function Mt(){var r,e,o,n,i,u;if(r=kt,124===t.charCodeAt(kt)?(e="|",kt++):(e=a,Ut(k)),e!==a){if(o=[],(n=Ot())!==a)for(;n!==a;)o.push(n),n=Ot();else o=a;if(o!==a)if(124===t.charCodeAt(kt)?(n="|",kt++):(n=a,Ut(k)),n!==a){if(i=[],(u=jt())!==a)for(;u!==a;)i.push(u),u=jt();else i=a;i!==a&&(u=_t())!==a?r=e=o:(kt=r,r=a)}else kt=r,r=a;else kt=r,r=a}else kt=r,r=a;return r}function Ot(){var r,e,o;return r=kt,e=function(){var r,e;return r=kt,32===t.charCodeAt(kt)?(e=m,kt++):(e=a,Ut(g)),e===a&&(43===t.charCodeAt(kt)?(e="+",kt++):(e=a,Ut(A)),e===a&&(94===t.charCodeAt(kt)?(e="^",kt++):(e=a,Ut(I)))),e!==a&&(e=0),(r=e)===a&&(r=kt,118===t.charCodeAt(kt)?(e="v",kt++):(e=a,Ut(K)),e===a&&(86===t.charCodeAt(kt)?(e="V",kt++):(e=a,Ut(C))),e!==a&&(e=1),r=e),r}(),e!==a&&(o=Ht())!==a?r=e={color:e,kind:o}:(kt=r,r=a),r===a&&(r=kt," ・"===t.substr(kt,2)?(e=" ・",kt+=2):(e=a,Ut(y)),e!==a&&(e={}),r=e),r}function St(){var r,e,o,n,i,u,s;if(r=kt,e=function(){var t,r,e,o;for(t=kt,r=[],e=Rt();e!==a;)r.push(e),e=Rt();return r!==a?((e=Nt())===a&&(e=null),e!==a?t=r=0==(o=r).length?{}:{comments:o}:(kt=t,t=a)):(kt=t,t=a),t}(),e!==a){for(o=[],n=Tt();n!==a;)o.push(n),n=Tt();o!==a?(n=function(){var r,e,o,n,i,u,s,c,l,f,h,d;if(r=kt,"まで"===t.substr(kt,2)?(e="まで",kt+=2):(e=a,Ut(j)),e!==a){if(o=[],W.test(t.charAt(kt))?(n=t.charAt(kt),kt++):(n=a,Ut(D)),n!==a)for(;n!==a;)o.push(n),W.test(t.charAt(kt))?(n=t.charAt(kt),kt++):(n=a,Ut(D));else o=a;o!==a?(25163===t.charCodeAt(kt)?(n="手",kt++):(n=a,Ut(z)),n!==a?(i=kt,12391===t.charCodeAt(kt)?(u="で",kt++):(u=a,Ut(J)),u!==a&&(s=Pt())!==a?("手の"===t.substr(kt,2)?(c="手の",kt+=2):(c=a,Ut(V)),c!==a?(l=kt,t.substr(kt,2)===Z?(f=Z,kt+=2):(f=a,Ut($)),f!==a&&(f="TORYO"),(l=f)===a&&(l=kt,"反則"===t.substr(kt,2)?(f="反則",kt+=2):(f=a,Ut(q)),f!==a?(h=kt,t.substr(kt,2)===Z?(d=Z,kt+=2):(d=a,Ut($)),d!==a&&(d="ILLEGAL_ACTION"),(h=d)===a&&(h=kt,"負け"===t.substr(kt,2)?(d="負け",kt+=2):(d=a,Ut(Q)),d!==a&&(d="ILLEGAL_MOVE"),h=d),h!==a?l=f=X(0,h):(kt=l,l=a)):(kt=l,l=a)),l!==a?i=u=X(0,l):(kt=i,i=a)):(kt=i,i=a)):(kt=i,i=a),i===a&&(i=kt,t.substr(kt,8)===tt?(u=tt,kt+=8):(u=a,Ut(rt)),u!==a&&(s=Pt())!==a?(t.substr(kt,4)===et?(c=et,kt+=4):(c=a,Ut(ot)),c!==a?i=u="TIME_UP":(kt=i,i=a)):(kt=i,i=a),i===a&&(i=kt,"で中断"===t.substr(kt,3)?(u="で中断",kt+=3):(u=a,Ut(nt)),u!==a&&(u="CHUDAN"),(i=u)===a&&(i=kt,t.substr(kt,4)===it?(u=it,kt+=4):(u=a,Ut(ut)),u!==a&&(u="JISHOGI"),(i=u)===a&&(i=kt,t.substr(kt,4)===at?(u=at,kt+=4):(u=a,Ut(st)),u!==a&&(u="SENNICHITE"),(i=u)===a&&(i=kt,12391===t.charCodeAt(kt)?(u="で",kt++):(u=a,Ut(J)),u===a&&(u=null),u!==a?(35440===t.charCodeAt(kt)?(s="詰",kt++):(s=a,Ut(ct)),s!==a?(12415===t.charCodeAt(kt)?(c="み",kt++):(c=a,Ut(lt)),c===a&&(c=null),c!==a?i=u="TSUMI":(kt=i,i=a)):(kt=i,i=a)):(kt=i,i=a),i===a&&(i=kt,"で不詰"===t.substr(kt,3)?(u="で不詰",kt+=3):(u=a,Ut(ft)),u!==a&&(u="FUZUMI"),i=u)))))),i!==a&&(u=_t())!==a?r=e=i:(kt=r,r=a)):(kt=r,r=a)):(kt=r,r=a)}else kt=r,r=a;return r}(),n===a&&(n=null),n!==a?(i=e,s=n,(u=o).unshift(i),s&&!u[u.length-1].special&&u.push({special:s}),r=e=u):(kt=r,r=a)):(kt=r,r=a)}else kt=r,r=a;return r}function Tt(){var r,e,o,n,i,u,s,c;if(r=kt,e=function(){var r,e,o,n,i;if(r=kt,x.test(t.charAt(kt))?(e=t.charAt(kt),kt++):(e=a,Ut(E)),e!==a)if(o=function(){var r,e,o,n,i,u,s;return r=kt,e=function(){var r,e,o;return r=kt,(e=function(){var r;return kt,P.test(t.charAt(kt))?(r=t.charAt(kt),kt++):(r=a,Ut(_)),r!==a&&(r="０１２３４５６７８９".indexOf(r)),r}())!==a?(o=function(){var r;return kt,Y.test(t.charAt(kt))?(r=t.charAt(kt),kt++):(r=a,Ut(B)),r!==a&&(r="〇一二三四五六七八九".indexOf(r)),r}(),o!==a?r=e={x:e,y:o}:(kt=r,r=a)):(kt=r,r=a),r===a&&(r=kt,21516===t.charCodeAt(kt)?(e="同",kt++):(e=a,Ut(M)),e!==a?(12288===t.charCodeAt(kt)?(o="　",kt++):(o=a,Ut(O)),o===a&&(o=null),o!==a?r=e={same:!0}:(kt=r,r=a)):(kt=r,r=a)),r}(),e!==a&&(o=Ht())!==a?(n=function(){var r;return N.test(t.charAt(kt))?(r=t.charAt(kt),kt++):(r=a,Ut(H)),r}(),n===a&&(n=null),n!==a?(i=function(){var r;return R.test(t.charAt(kt))?(r=t.charAt(kt),kt++):(r=a,Ut(G)),r}(),i===a&&(i=null),i!==a?(25104===t.charCodeAt(kt)?(u="成",kt++):(u=a,Ut(U)),u===a&&("不成"===t.substr(kt,2)?(u="不成",kt+=2):(u=a,Ut(b))),u===a&&(u=null),u!==a?(25171===t.charCodeAt(kt)?(s="打",kt++):(s=a,Ut(w)),s===a&&(s=null),s!==a?r=e=function(t,r,e,o,n,i){var u={piece:r};if(t.same?u.same=!0:u.to=t,n&&(u.promote="成"==n),i)u.relative="H";else{var a=({左:"L",直:"C",右:"R"}[e]||"")+({上:"U",寄:"M",引:"D"}[o]||"");""!=a&&(u.relative=a)}return u}(e,o,n,i,u,s):(kt=r,r=a)):(kt=r,r=a)):(kt=r,r=a)):(kt=r,r=a)):(kt=r,r=a),r}(),o!==a){for(n=[],(i=_t())===a&&(32===t.charCodeAt(kt)?(i=m,kt++):(i=a,Ut(g)));i!==a;)n.push(i),(i=_t())===a&&(32===t.charCodeAt(kt)?(i=m,kt++):(i=a,Ut(g)));n!==a?r=e=o:(kt=r,r=a)}else kt=r,r=a;else kt=r,r=a;return r}(),e!==a){for(o=[],n=Rt();n!==a;)o.push(n),n=Rt();if(o!==a)if((n=Nt())===a&&(n=null),n!==a){for(i=[],(u=_t())===a&&(32===t.charCodeAt(kt)?(u=m,kt++):(u=a,Ut(g)));u!==a;)i.push(u),(u=_t())===a&&(32===t.charCodeAt(kt)?(u=m,kt++):(u=a,Ut(g)));i!==a?(c={move:e},(s=o).length>0&&(c.comments=s),r=e=c):(kt=r,r=a)}else kt=r,r=a;else kt=r,r=a}else kt=r,r=a;return r}function Nt(){var r,e,o,n;if(r=kt,38===t.charCodeAt(kt)?(e="&",kt++):(e=a,Ut(F)),e!==a){for(o=[],n=jt();n!==a;)o.push(n),n=jt();o!==a&&(n=_t())!==a?r=e=[e,o,n]:(kt=r,r=a)}else kt=r,r=a;return r}function Ht(){var r,e,o;return r=kt,25104===t.charCodeAt(kt)?(e="成",kt++):(e=a,Ut(U)),e===a&&(e=null),e!==a?(S.test(t.charAt(kt))?(o=t.charAt(kt),kt++):(o=a,Ut(T)),o!==a?r=e=Dt((e||"")+o):(kt=r,r=a)):(kt=r,r=a),r}function Rt(){var r,e,o,n;if(r=kt,42===t.charCodeAt(kt)?(e="*",kt++):(e=a,Ut(L)),e!==a){for(o=[],n=jt();n!==a;)o.push(n),n=jt();o!==a&&(n=_t())!==a?r=e=o.join(""):(kt=r,r=a)}else kt=r,r=a;return r}function Gt(){var r,e,o,n,i,u,s;if(r=kt,"変化："===t.substr(kt,3)?(e="変化：",kt+=3):(e=a,Ut(ht)),e!==a){for(o=[],32===t.charCodeAt(kt)?(n=m,kt++):(n=a,Ut(g));n!==a;)o.push(n),32===t.charCodeAt(kt)?(n=m,kt++):(n=a,Ut(g));if(o!==a){if(n=[],W.test(t.charAt(kt))?(i=t.charAt(kt),kt++):(i=a,Ut(D)),i!==a)for(;i!==a;)n.push(i),W.test(t.charAt(kt))?(i=t.charAt(kt),kt++):(i=a,Ut(D));else n=a;n!==a?(25163===t.charCodeAt(kt)?(i="手",kt++):(i=a,Ut(z)),i!==a&&_t()!==a&&(u=St())!==a?(s=u,r=e={te:parseInt(n.join("")),moves:s.slice(1)}):(kt=r,r=a)):(kt=r,r=a)}else kt=r,r=a}else kt=r,r=a;return r}function Pt(){var r;return d.test(t.charAt(kt))?(r=t.charAt(kt),kt++):(r=a,Ut(p)),r}function _t(){var t,r,e,o;if(t=kt,r=[],(e=Lt())!==a)for(;e!==a;)r.push(e),e=Lt();else r=a;if(r!==a){for(e=[],o=Yt();o!==a;)e.push(o),o=Yt();e!==a?t=r=[r,e]:(kt=t,t=a)}else kt=t,t=a;return t}function Yt(){var r,e,o,n;if(r=kt,35===t.charCodeAt(kt)?(e="#",kt++):(e=a,Ut(dt)),e!==a){for(o=[],n=jt();n!==a;)o.push(n),n=jt();o!==a&&(n=Lt())!==a?r=e=[e,o,n]:(kt=r,r=a)}else kt=r,r=a;return r}function Bt(){var r;return 32===t.charCodeAt(kt)?(r=m,kt++):(r=a,Ut(g)),r===a&&(9===t.charCodeAt(kt)?(r="\t",kt++):(r=a,Ut(pt))),r}function Lt(){var r,e,o,n,i;for(r=kt,e=[],o=Bt();o!==a;)e.push(o),o=Bt();return e!==a?(10===t.charCodeAt(kt)?(o="\n",kt++):(o=a,Ut(vt)),o===a&&(o=kt,13===t.charCodeAt(kt)?(n="\r",kt++):(n=a,Ut(mt)),n!==a?(10===t.charCodeAt(kt)?(i="\n",kt++):(i=a,Ut(vt)),i===a&&(i=null),i!==a?o=n=[n,i]:(kt=o,o=a)):(kt=o,o=a)),o!==a?r=e=[e,o]:(kt=r,r=a)):(kt=r,r=a),r}function jt(){var r;return gt.test(t.charAt(kt))?(r=t.charAt(kt),kt++):(r=a,Ut(At)),r}function Wt(t){switch(t.length){case 1:return"〇一二三四五六七八九十".indexOf(t);case 2:return"〇一二三四五六七八九十".indexOf(t[1])+10;default:throw"21以上の数値に対応していません"}}function Dt(t){return"成"==t[0]?{香:"NY",桂:"NK",銀:"NG"}[t[1]]:{歩:"FU",香:"KY",桂:"KE",銀:"GI",金:"KI",角:"KA",飛:"HI",玉:"OU",王:"OU",と:"TO",杏:"NY",圭:"NK",全:"NG",馬:"UM",竜:"RY",龍:"RY"}[t]}function zt(t){var r=t.replace(/　$/,"").split("　"),e={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0};if(""==t)return e;for(var o=0;o<r.length;o++)e[Dt(r[o][0])]=1==r[o].length?1:Wt(r[o].slice(1));return e}if((o=c())!==a&&kt===t.length)return o;throw o!==a&&kt<t.length&&Ut({type:"end"}),n=Kt,i=It<t.length?t.charAt(It):null,u=It<t.length?Et(It,It+1):Et(It,It),new r(r.buildMessage(n,i),n,i,u)}}},516:t=>{"use strict";function r(t,e,o,n){this.message=t,this.expected=e,this.found=o,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,r)}!function(t,r){function e(){this.constructor=t}e.prototype=r.prototype,t.prototype=new e}(r,Error),r.buildMessage=function(t,r){var e={literal:function(t){return'"'+n(t.text)+'"'},class:function(t){var r,e="";for(r=0;r<t.parts.length;r++)e+=t.parts[r]instanceof Array?i(t.parts[r][0])+"-"+i(t.parts[r][1]):i(t.parts[r]);return"["+(t.inverted?"^":"")+e+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function o(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+o(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+o(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+o(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+o(t)}))}return"Expected "+function(t){var r,o,n,i=new Array(t.length);for(r=0;r<t.length;r++)i[r]=(n=t[r],e[n.type](n));if(i.sort(),i.length>0){for(r=1,o=1;r<i.length;r++)i[r-1]!==i[r]&&(i[o]=i[r],o++);i.length=o}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+n(t)+'"':"end of input"}(r)+" found."},t.exports={SyntaxError:r,parse:function(t,e){e=void 0!==e?e:{};var o,n,i,u,a={},s={kifu:Pt},c=Pt,l=/^[^\uFF1A\r\n]/,f=Nt(["：","\r","\n"],!0,!1),h=Tt("：",!1),d=Tt("手番",!1),p="盤面回転",v=Tt("盤面回転",!1),m=/^[\u5148\u5F8C\u4E0A\u4E0B]/,g=Nt(["先","後","上","下"],!1,!1),A=" ",k=Tt(" ",!1),y="+",I=Tt("+",!1),K=Tt("|",!1),C=Tt(" ・",!1),F=Tt("^",!1),x=Tt("v",!1),E=Tt("V",!1),U="手数----指手--",b=Tt("手数----指手--",!1),w="-------消費時間--",M=Tt("-------消費時間--",!1),O=Tt("&",!1),S=/^[^\r\n ]/,T=Nt(["\r","\n"," "],!0,!1),N=/^[0-9]/,H=Nt([["0","9"]],!1,!1),R=Tt("成",!1),G=Tt("同",!1),P=Tt("　",!1),_=/^[\uFF11\uFF12\uFF13\uFF14\uFF15\uFF16\uFF17\uFF18\uFF19]/,Y=Nt(["１","２","３","４","５","６","７","８","９"],!1,!1),B=/^[\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D]/,L=Nt(["一","二","三","四","五","六","七","八","九"],!1,!1),j=/^[\u6B69\u9999\u6842\u9280\u91D1\u89D2\u98DB\u738B\u7389\u3068\u674F\u572D\u5168\u99AC\u7ADC\u9F8D]/,W=Nt(["歩","香","桂","銀","金","角","飛","王","玉","と","杏","圭","全","馬","竜","龍"],!1,!1),D=Tt("打",!1),z=Tt("(",!1),J=/^[1-9]/,V=Nt([["1","9"]],!1,!1),Z=Tt(")",!1),$=Tt("/",!1),q=Tt(":",!1),Q=Tt("*",!1),X=Tt("まで",!1),tt=Tt("手",!1),rt=Tt("で",!1),et=Tt("手の",!1),ot="勝ち",nt=Tt("勝ち",!1),it=Tt("反則",!1),ut=Tt("負け",!1),at=function(t,r){return r},st="で時間切れにより",ct=Tt("で時間切れにより",!1),lt="手の勝ち",ft=Tt("手の勝ち",!1),ht=Tt("で中断",!1),dt="で封じ手",pt=Tt("で封じ手",!1),vt="で持将棋",mt=Tt("で持将棋",!1),gt="で千日手",At=Tt("で千日手",!1),kt=Tt("詰",!1),yt=Tt("み",!1),It=Tt("で不詰",!1),Kt=Tt("変化：",!1),Ct=Tt("#",!1),Ft=Tt("\t",!1),xt=Tt("\n",!1),Et=Tt("\r",!1),Ut=/^[^\r\n]/,bt=Nt(["\r","\n"],!0,!1),wt=0,Mt=[{line:1,column:1}],Ot=0,St=[];if("startRule"in e){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');c=s[e.startRule]}function Tt(t,r){return{type:"literal",text:t,ignoreCase:r}}function Nt(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function Ht(r){var e,o=Mt[r];if(o)return o;for(e=r-1;!Mt[e];)e--;for(o={line:(o=Mt[e]).line,column:o.column};e<r;)10===t.charCodeAt(e)?(o.line++,o.column=1):o.column++,e++;return Mt[r]=o,o}function Rt(t,r){var e=Ht(t),o=Ht(r);return{start:{offset:t,line:e.line,column:e.column},end:{offset:r,line:o.line,column:o.column}}}function Gt(t){wt<Ot||(wt>Ot&&(Ot=wt,St=[]),St.push(t))}function Pt(){var r,e,o,n,i,u,s,c,l;for(r=wt,e=[],o=qt();o!==a;)e.push(o),o=qt();if(e!==a){for(o=[],n=_t();n!==a;)o.push(n),n=_t();if(o!==a)if(n=function(){var r,e,o,n,i,u,s,c;if(r=wt,e=wt,32===t.charCodeAt(wt)?(o=A,wt++):(o=a,Gt(k)),o!==a){for(n=[],i=tr();i!==a;)n.push(i),i=tr();n!==a&&(i=$t())!==a?e=o=[o,n,i]:(wt=e,e=a)}else wt=e,e=a;if(e===a&&(e=null),e!==a){if(o=wt,43===t.charCodeAt(wt)?(n=y,wt++):(n=a,Gt(I)),n!==a){for(i=[],u=tr();u!==a;)i.push(u),u=tr();i!==a&&(u=$t())!==a?o=n=[n,i,u]:(wt=o,o=a)}else wt=o,o=a;if(o===a&&(o=null),o!==a){if(n=[],(i=Bt())!==a)for(;i!==a;)n.push(i),i=Bt();else n=a;if(n!==a){if(i=wt,43===t.charCodeAt(wt)?(u=y,wt++):(u=a,Gt(I)),u!==a){for(s=[],c=tr();c!==a;)s.push(c),c=tr();s!==a&&(c=$t())!==a?i=u=[u,s,c]:(wt=i,i=a)}else wt=i,i=a;i===a&&(i=null),i!==a?r=e=function(t){for(var r=[],e=0;e<9;e++){for(var o=[],n=0;n<9;n++)o.push(t[n][8-e]);r.push(o)}return{preset:"OTHER",data:{board:r}}}(n):(wt=r,r=a)}else wt=r,r=a}else wt=r,r=a}else wt=r,r=a;return r}(),n===a&&(n=null),n!==a){for(i=[],u=_t();u!==a;)i.push(u),u=_t();if(i!==a)if((u=jt())===a&&(u=null),u!==a)if((s=Wt())!==a){for(c=[],l=Zt();l!==a;)c.push(l),l=Zt();c!==a?((l=$t())===a&&(l=null),l!==a?r=e=function(t,r,e,o,n){for(var i={header:{},moves:o},u=0;u<t.length;u++)t[u]&&(i.header[t[u].k]=t[u].v);for(u=0;u<e.length;u++)e[u]&&(i.header[e[u].k]=e[u].v);if(r)i.initial=r;else if(i.header["手合割"]){var a=function(t){return{平手:"HIRATE",香落ち:"KY",右香落ち:"KY_R",角落ち:"KA",飛車落ち:"HI",飛香落ち:"HIKY",二枚落ち:"2",三枚落ち:"3",四枚落ち:"4",五枚落ち:"5",左五枚落ち:"5_L",六枚落ち:"6",左七枚落ち:"7_L",右七枚落ち:"7_R",八枚落ち:"8",十枚落ち:"10",その他:"OTHER"}[t.replace(/\s/g,"")]}(i.header["手合割"]);"OTHER"!=a&&(i.initial={preset:a})}i.initial&&i.initial.data&&(i.header["手番"]?(i.initial.data.color="下先".indexOf(i.header["手番"])>=0?0:1,delete i.header["手番"]):i.initial.data.color=0,i.initial.data.hands=[nr(i.header["先手の持駒"]||i.header["下手の持駒"]),nr(i.header["後手の持駒"]||i.header["上手の持駒"])],delete i.header["先手の持駒"],delete i.header["下手の持駒"],delete i.header["後手の持駒"],delete i.header["上手の持駒"]);var s=[{te:0,moves:o}];for(u=0;u<n.length;u++){for(var c=n[u],l=s.pop();l.te>=c.te;)l=s.pop();var f=l.moves[c.te-l.te];f.forks=f.forks||[],f.forks.push(c.moves),s.push(l),s.push(c)}return i}(o,n,i,s,c):(wt=r,r=a)):(wt=r,r=a)}else wt=r,r=a;else wt=r,r=a;else wt=r,r=a}else wt=r,r=a;else wt=r,r=a}else wt=r,r=a;return r}function _t(){var r,e,o,n,i,u;if(r=wt,e=[],l.test(t.charAt(wt))?(o=t.charAt(wt),wt++):(o=a,Gt(f)),o!==a)for(;o!==a;)e.push(o),l.test(t.charAt(wt))?(o=t.charAt(wt),wt++):(o=a,Gt(f));else e=a;if(e!==a)if(65306===t.charCodeAt(wt)?(o="：",wt++):(o=a,Gt(h)),o!==a){for(n=[],i=tr();i!==a;)n.push(i),i=tr();n!==a&&(i=$t())!==a?(u=n,r=e={k:e.join(""),v:u.join("")}):(wt=r,r=a)}else wt=r,r=a;else wt=r,r=a;return r===a&&(r=wt,(e=Yt())!==a?("手番"===t.substr(wt,2)?(o="手番",wt+=2):(o=a,Gt(d)),o!==a&&(n=$t())!==a?r=e={k:"手番",v:e}:(wt=r,r=a)):(wt=r,r=a),r===a&&(r=wt,t.substr(wt,4)===p?(e=p,wt+=4):(e=a,Gt(v)),e!==a&&(o=$t())!==a?r=e=null:(wt=r,r=a))),r}function Yt(){var r;return m.test(t.charAt(wt))?(r=t.charAt(wt),wt++):(r=a,Gt(g)),r}function Bt(){var r,e,o,n,i,u;if(r=wt,124===t.charCodeAt(wt)?(e="|",wt++):(e=a,Gt(K)),e!==a){if(o=[],(n=Lt())!==a)for(;n!==a;)o.push(n),n=Lt();else o=a;if(o!==a)if(124===t.charCodeAt(wt)?(n="|",wt++):(n=a,Gt(K)),n!==a){if(i=[],(u=tr())!==a)for(;u!==a;)i.push(u),u=tr();else i=a;i!==a&&(u=$t())!==a?r=e=o:(wt=r,r=a)}else wt=r,r=a;else wt=r,r=a}else wt=r,r=a;return r}function Lt(){var r,e,o;return r=wt,e=function(){var r,e;return r=wt,32===t.charCodeAt(wt)?(e=A,wt++):(e=a,Gt(k)),e===a&&(43===t.charCodeAt(wt)?(e=y,wt++):(e=a,Gt(I)),e===a&&(94===t.charCodeAt(wt)?(e="^",wt++):(e=a,Gt(F)))),e!==a&&(e=0),(r=e)===a&&(r=wt,118===t.charCodeAt(wt)?(e="v",wt++):(e=a,Gt(x)),e===a&&(86===t.charCodeAt(wt)?(e="V",wt++):(e=a,Gt(E))),e!==a&&(e=1),r=e),r}(),e!==a&&(o=Jt())!==a?r=e={color:e,kind:o}:(wt=r,r=a),r===a&&(r=wt," ・"===t.substr(wt,2)?(e=" ・",wt+=2):(e=a,Gt(C)),e!==a&&(e={}),r=e),r}function jt(){var r,e,o,n;return r=wt,t.substr(wt,10)===U?(e=U,wt+=10):(e=a,Gt(b)),e!==a?(t.substr(wt,13)===w?(o=w,wt+=13):(o=a,Gt(M)),o===a&&(o=null),o!==a&&(n=$t())!==a?r=e=[e,o,n]:(wt=r,r=a)):(wt=r,r=a),r}function Wt(){var r,e,o,n,i,u,s;if(r=wt,e=function(){var t,r,e,o;for(t=wt,r=[],e=Vt();e!==a;)r.push(e),e=Vt();return r!==a?((e=zt())===a&&(e=null),e!==a?t=r=0==(o=r).length?{}:{comments:o}:(wt=t,t=a)):(wt=t,t=a),t}(),e!==a)if((o=jt())===a&&(o=null),o!==a){for(n=[],i=Dt();i!==a;)n.push(i),i=Dt();n!==a?(i=function(){var r,e,o,n,i,u,s,c,l,f,h,d;if(r=wt,"まで"===t.substr(wt,2)?(e="まで",wt+=2):(e=a,Gt(X)),e!==a){if(o=[],N.test(t.charAt(wt))?(n=t.charAt(wt),wt++):(n=a,Gt(H)),n!==a)for(;n!==a;)o.push(n),N.test(t.charAt(wt))?(n=t.charAt(wt),wt++):(n=a,Gt(H));else o=a;o!==a?(25163===t.charCodeAt(wt)?(n="手",wt++):(n=a,Gt(tt)),n!==a?(i=wt,12391===t.charCodeAt(wt)?(u="で",wt++):(u=a,Gt(rt)),u!==a&&(s=Yt())!==a?("手の"===t.substr(wt,2)?(c="手の",wt+=2):(c=a,Gt(et)),c!==a?(l=wt,t.substr(wt,2)===ot?(f=ot,wt+=2):(f=a,Gt(nt)),f!==a&&(f="TORYO"),(l=f)===a&&(l=wt,"反則"===t.substr(wt,2)?(f="反則",wt+=2):(f=a,Gt(it)),f!==a?(h=wt,t.substr(wt,2)===ot?(d=ot,wt+=2):(d=a,Gt(nt)),d!==a&&(d="ILLEGAL_ACTION"),(h=d)===a&&(h=wt,"負け"===t.substr(wt,2)?(d="負け",wt+=2):(d=a,Gt(ut)),d!==a&&(d="ILLEGAL_MOVE"),h=d),h!==a?l=f=at(0,h):(wt=l,l=a)):(wt=l,l=a)),l!==a?i=u=at(0,l):(wt=i,i=a)):(wt=i,i=a)):(wt=i,i=a),i===a&&(i=wt,t.substr(wt,8)===st?(u=st,wt+=8):(u=a,Gt(ct)),u!==a&&(s=Yt())!==a?(t.substr(wt,4)===lt?(c=lt,wt+=4):(c=a,Gt(ft)),c!==a?i=u="TIME_UP":(wt=i,i=a)):(wt=i,i=a),i===a&&(i=wt,"で中断"===t.substr(wt,3)?(u="で中断",wt+=3):(u=a,Gt(ht)),u!==a&&(u="CHUDAN"),(i=u)===a&&(i=wt,t.substr(wt,4)===dt?(u=dt,wt+=4):(u=a,Gt(pt)),u!==a&&(u="CHUDAN"),(i=u)===a&&(i=wt,t.substr(wt,4)===vt?(u=vt,wt+=4):(u=a,Gt(mt)),u!==a&&(u="JISHOGI"),(i=u)===a&&(i=wt,t.substr(wt,4)===gt?(u=gt,wt+=4):(u=a,Gt(At)),u!==a&&(u="SENNICHITE"),(i=u)===a&&(i=wt,12391===t.charCodeAt(wt)?(u="で",wt++):(u=a,Gt(rt)),u===a&&(u=null),u!==a?(35440===t.charCodeAt(wt)?(s="詰",wt++):(s=a,Gt(kt)),s!==a?(12415===t.charCodeAt(wt)?(c="み",wt++):(c=a,Gt(yt)),c===a&&(c=null),c!==a?i=u="TSUMI":(wt=i,i=a)):(wt=i,i=a)):(wt=i,i=a),i===a&&(i=wt,"で不詰"===t.substr(wt,3)?(u="で不詰",wt+=3):(u=a,Gt(It)),u!==a&&(u="FUZUMI"),i=u))))))),i!==a&&(u=$t())!==a?r=e=i:(wt=r,r=a)):(wt=r,r=a)):(wt=r,r=a)}else wt=r,r=a;return r}(),i===a&&(i=null),i!==a?(u=e,(s=n).unshift(u),r=e=s):(wt=r,r=a)):(wt=r,r=a)}else wt=r,r=a;else wt=r,r=a;return r}function Dt(){var r,e,o,n,i,u,s;if(r=wt,e=function(){var r,e,o,n,i,u,s,c,l,f,h;for(r=wt,e=[],32===t.charCodeAt(wt)?(o=A,wt++):(o=a,Gt(k));o!==a;)e.push(o),32===t.charCodeAt(wt)?(o=A,wt++):(o=a,Gt(k));if(e!==a)if(o=function(){var r,e;if(r=[],N.test(t.charAt(wt))?(e=t.charAt(wt),wt++):(e=a,Gt(H)),e!==a)for(;e!==a;)r.push(e),N.test(t.charAt(wt))?(e=t.charAt(wt),wt++):(e=a,Gt(H));else r=a;return r}(),o!==a){for(n=[],32===t.charCodeAt(wt)?(i=A,wt++):(i=a,Gt(k));i!==a;)n.push(i),32===t.charCodeAt(wt)?(i=A,wt++):(i=a,Gt(k));if(n!==a){if(i=wt,u=function(){var r,e,o,n;return r=wt,e=function(){var r,e,o;return r=wt,(e=function(){var r;return wt,_.test(t.charAt(wt))?(r=t.charAt(wt),wt++):(r=a,Gt(Y)),r!==a&&(r="０１２３４５６７８９".indexOf(r)),r}())!==a?(o=function(){var r;return wt,B.test(t.charAt(wt))?(r=t.charAt(wt),wt++):(r=a,Gt(L)),r!==a&&(r="〇一二三四五六七八九".indexOf(r)),r}(),o!==a?r=e={x:e,y:o}:(wt=r,r=a)):(wt=r,r=a),r===a&&(r=wt,21516===t.charCodeAt(wt)?(e="同",wt++):(e=a,Gt(G)),e!==a?(12288===t.charCodeAt(wt)?(o="　",wt++):(o=a,Gt(P)),o===a&&(o=null),o!==a?r=e=null:(wt=r,r=a)):(wt=r,r=a)),r}(),e!==a&&(o=Jt())!==a?(25104===t.charCodeAt(wt)?(n="成",wt++):(n=a,Gt(R)),n===a&&(n=null),n!==a?r=e={to:e,piece:o,promote:!!n}:(wt=r,r=a)):(wt=r,r=a),r}(),u!==a?(s=function(){var r,e,o,n,i,u;return r=wt,25171===t.charCodeAt(wt)?(e="打",wt++):(e=a,Gt(D)),e!==a&&(e=null),(r=e)===a&&(r=wt,40===t.charCodeAt(wt)?(e="(",wt++):(e=a,Gt(z)),e!==a?(J.test(t.charAt(wt))?(o=t.charAt(wt),wt++):(o=a,Gt(V)),o!==a?(J.test(t.charAt(wt))?(n=t.charAt(wt),wt++):(n=a,Gt(V)),n!==a?(41===t.charCodeAt(wt)?(i=")",wt++):(i=a,Gt(Z)),i!==a?(u=n,r=e={x:parseInt(o),y:parseInt(u)}):(wt=r,r=a)):(wt=r,r=a)):(wt=r,r=a)):(wt=r,r=a)),r}(),s!==a?(f=s,h={piece:(l=u).piece},l.to?h.to=l.to:h.same=!0,l.promote&&(h.promote=!0),f&&(h.from=f),i=u=h):(wt=i,i=a)):(wt=i,i=a),i===a){for(i=wt,u=[],S.test(t.charAt(wt))?(s=t.charAt(wt),wt++):(s=a,Gt(T));s!==a;)u.push(s),S.test(t.charAt(wt))?(s=t.charAt(wt),wt++):(s=a,Gt(T));u!==a&&(u=u.join("")),i=u}if(i!==a){for(u=[],32===t.charCodeAt(wt)?(s=A,wt++):(s=a,Gt(k));s!==a;)u.push(s),32===t.charCodeAt(wt)?(s=A,wt++):(s=a,Gt(k));u!==a?(s=function(){var r,e,o,n,i,u,s,c,l;if(r=wt,40===t.charCodeAt(wt)?(e="(",wt++):(e=a,Gt(z)),e!==a){for(o=[],32===t.charCodeAt(wt)?(n=A,wt++):(n=a,Gt(k));n!==a;)o.push(n),32===t.charCodeAt(wt)?(n=A,wt++):(n=a,Gt(k));if(o!==a)if(n=function(){var r,e,o,n,i,u;if(r=wt,e=[],N.test(t.charAt(wt))?(o=t.charAt(wt),wt++):(o=a,Gt(H)),o!==a)for(;o!==a;)e.push(o),N.test(t.charAt(wt))?(o=t.charAt(wt),wt++):(o=a,Gt(H));else e=a;if(e!==a)if(58===t.charCodeAt(wt)?(o=":",wt++):(o=a,Gt(q)),o!==a){if(n=[],N.test(t.charAt(wt))?(i=t.charAt(wt),wt++):(i=a,Gt(H)),i!==a)for(;i!==a;)n.push(i),N.test(t.charAt(wt))?(i=t.charAt(wt),wt++):(i=a,Gt(H));else n=a;n!==a?(u=n,r=e={m:rr(e),s:rr(u)}):(wt=r,r=a)}else wt=r,r=a;else wt=r,r=a;return r}(),n!==a){for(i=[],32===t.charCodeAt(wt)?(u=A,wt++):(u=a,Gt(k));u!==a;)i.push(u),32===t.charCodeAt(wt)?(u=A,wt++):(u=a,Gt(k));if(i!==a)if(47===t.charCodeAt(wt)?(u="/",wt++):(u=a,Gt($)),u!==a){for(s=[],32===t.charCodeAt(wt)?(c=A,wt++):(c=a,Gt(k));c!==a;)s.push(c),32===t.charCodeAt(wt)?(c=A,wt++):(c=a,Gt(k));s!==a?(c=function(){var r,e,o,n,i,u,s,c,l;if(r=wt,e=[],N.test(t.charAt(wt))?(o=t.charAt(wt),wt++):(o=a,Gt(H)),o!==a)for(;o!==a;)e.push(o),N.test(t.charAt(wt))?(o=t.charAt(wt),wt++):(o=a,Gt(H));else e=a;if(e!==a)if(58===t.charCodeAt(wt)?(o=":",wt++):(o=a,Gt(q)),o!==a){if(n=[],N.test(t.charAt(wt))?(i=t.charAt(wt),wt++):(i=a,Gt(H)),i!==a)for(;i!==a;)n.push(i),N.test(t.charAt(wt))?(i=t.charAt(wt),wt++):(i=a,Gt(H));else n=a;if(n!==a)if(58===t.charCodeAt(wt)?(i=":",wt++):(i=a,Gt(q)),i!==a){if(u=[],N.test(t.charAt(wt))?(s=t.charAt(wt),wt++):(s=a,Gt(H)),s!==a)for(;s!==a;)u.push(s),N.test(t.charAt(wt))?(s=t.charAt(wt),wt++):(s=a,Gt(H));else u=a;u!==a?(c=n,l=u,r=e={h:rr(e),m:rr(c),s:rr(l)}):(wt=r,r=a)}else wt=r,r=a;else wt=r,r=a}else wt=r,r=a;else wt=r,r=a;return r}(),c!==a?(41===t.charCodeAt(wt)?(l=")",wt++):(l=a,Gt(Z)),l!==a?r=e={now:n,total:c}:(wt=r,r=a)):(wt=r,r=a)):(wt=r,r=a)}else wt=r,r=a;else wt=r,r=a}else wt=r,r=a;else wt=r,r=a}else wt=r,r=a;return r}(),s===a&&(s=null),s!==a?(43===t.charCodeAt(wt)?(c=y,wt++):(c=a,Gt(I)),c===a&&(c=null),c!==a&&$t()!==a?r=e={move:i,time:s}:(wt=r,r=a)):(wt=r,r=a)):(wt=r,r=a)}else wt=r,r=a}else wt=r,r=a}else wt=r,r=a;else wt=r,r=a;return r}(),e!==a){for(o=[],n=Vt();n!==a;)o.push(n),n=Vt();o!==a?((n=zt())===a&&(n=null),n!==a?(i=e,s={},(u=o).length>0&&(s.comments=u),"object"==typeof i.move?s.move=i.move:s.special={中断:"CHUDAN",封じ手:"CHUDAN",投了:"TORYO",持将棋:"JISHOGI",千日手:"SENNICHITE",詰み:"TSUMI",不詰:"FUZUMI",切れ負け:"TIME_UP",反則勝ち:"ILLEGAL_ACTION",反則負け:"ILLEGAL_MOVE"}[i.move],i.time&&(s.time=i.time),r=e=s):(wt=r,r=a)):(wt=r,r=a)}else wt=r,r=a;return r}function zt(){var r,e,o,n;if(r=wt,38===t.charCodeAt(wt)?(e="&",wt++):(e=a,Gt(O)),e!==a){for(o=[],n=tr();n!==a;)o.push(n),n=tr();o!==a&&(n=$t())!==a?r=e=[e,o,n]:(wt=r,r=a)}else wt=r,r=a;return r}function Jt(){var r,e,o;return r=wt,25104===t.charCodeAt(wt)?(e="成",wt++):(e=a,Gt(R)),e===a&&(e=null),e!==a?(j.test(t.charAt(wt))?(o=t.charAt(wt),wt++):(o=a,Gt(W)),o!==a?r=e=or((e||"")+o):(wt=r,r=a)):(wt=r,r=a),r}function Vt(){var r,e,o,n;if(r=wt,42===t.charCodeAt(wt)?(e="*",wt++):(e=a,Gt(Q)),e!==a){for(o=[],n=tr();n!==a;)o.push(n),n=tr();o!==a&&(n=$t())!==a?r=e=o.join(""):(wt=r,r=a)}else wt=r,r=a;if(r===a)if(r=wt,38===t.charCodeAt(wt)?(e="&",wt++):(e=a,Gt(O)),e!==a){for(o=[],n=tr();n!==a;)o.push(n),n=tr();o!==a&&(n=$t())!==a?r=e="&"+o.join(""):(wt=r,r=a)}else wt=r,r=a;return r}function Zt(){var r,e,o,n,i,u,s;if(r=wt,"変化："===t.substr(wt,3)?(e="変化：",wt+=3):(e=a,Gt(Kt)),e!==a){for(o=[],32===t.charCodeAt(wt)?(n=A,wt++):(n=a,Gt(k));n!==a;)o.push(n),32===t.charCodeAt(wt)?(n=A,wt++):(n=a,Gt(k));if(o!==a){if(n=[],N.test(t.charAt(wt))?(i=t.charAt(wt),wt++):(i=a,Gt(H)),i!==a)for(;i!==a;)n.push(i),N.test(t.charAt(wt))?(i=t.charAt(wt),wt++):(i=a,Gt(H));else n=a;n!==a?(25163===t.charCodeAt(wt)?(i="手",wt++):(i=a,Gt(tt)),i!==a&&$t()!==a&&(u=Wt())!==a?(s=u,r=e={te:parseInt(n.join("")),moves:s.slice(1)}):(wt=r,r=a)):(wt=r,r=a)}else wt=r,r=a}else wt=r,r=a;return r}function $t(){var t,r,e,o;if(t=wt,r=[],(e=Xt())!==a)for(;e!==a;)r.push(e),e=Xt();else r=a;if(r!==a){for(e=[],o=qt();o!==a;)e.push(o),o=qt();e!==a?t=r=[r,e]:(wt=t,t=a)}else wt=t,t=a;return t}function qt(){var r,e,o,n;if(r=wt,35===t.charCodeAt(wt)?(e="#",wt++):(e=a,Gt(Ct)),e!==a){for(o=[],n=tr();n!==a;)o.push(n),n=tr();o!==a&&(n=Xt())!==a?r=e=[e,o,n]:(wt=r,r=a)}else wt=r,r=a;return r}function Qt(){var r;return 32===t.charCodeAt(wt)?(r=A,wt++):(r=a,Gt(k)),r===a&&(9===t.charCodeAt(wt)?(r="\t",wt++):(r=a,Gt(Ft))),r}function Xt(){var r,e,o,n,i;for(r=wt,e=[],o=Qt();o!==a;)e.push(o),o=Qt();return e!==a?(10===t.charCodeAt(wt)?(o="\n",wt++):(o=a,Gt(xt)),o===a&&(o=wt,13===t.charCodeAt(wt)?(n="\r",wt++):(n=a,Gt(Et)),n!==a?(10===t.charCodeAt(wt)?(i="\n",wt++):(i=a,Gt(xt)),i===a&&(i=null),i!==a?o=n=[n,i]:(wt=o,o=a)):(wt=o,o=a)),o!==a?r=e=[e,o]:(wt=r,r=a)):(wt=r,r=a),r}function tr(){var r;return Ut.test(t.charAt(wt))?(r=t.charAt(wt),wt++):(r=a,Gt(bt)),r}function rr(t){return parseInt(t.join(""),10)}function er(t){switch(t.length){case 1:return"〇一二三四五六七八九十".indexOf(t);case 2:return"〇一二三四五六七八九十".indexOf(t[1])+10;default:throw"21以上の数値に対応していません"}}function or(t){return"成"==t[0]?{香:"NY",桂:"NK",銀:"NG"}[t[1]]:{歩:"FU",香:"KY",桂:"KE",銀:"GI",金:"KI",角:"KA",飛:"HI",玉:"OU",王:"OU",と:"TO",杏:"NY",圭:"NK",全:"NG",馬:"UM",竜:"RY",龍:"RY"}[t]}function nr(t){var r=t.split(/[ 　]/),e={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0};if(""==t)return e;for(var o=0;o<r.length;o++)""!=r[o]&&(e[or(r[o][0])]=1==r[o].length?1:er(r[o].slice(1)));return e}if((o=c())!==a&&wt===t.length)return o;throw o!==a&&wt<t.length&&Gt({type:"end"}),n=St,i=Ot<t.length?t.charAt(Ot):null,u=Ot<t.length?Rt(Ot,Ot+1):Rt(Ot,Ot),new r(r.buildMessage(n,i),n,i,u)}}},886:t=>{t.exports=function(t){var r={};function e(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=t,e.c=r,e.d=function(t,r,o){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var n in t)e.d(o,n,function(r){return t[r]}.bind(null,n));return o},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="",e(e.s=2)}([function(t,r,e){"use strict";var o;r.__esModule=!0,function(t){t[t.Black=0]="Black",t[t.White=1]="White"}(o||(o={})),r.default=o},function(t,r,e){"use strict";r.__esModule=!0;var o=e(0),n=function(){function t(t){this.color="+"===t.slice(0,1)?o.default.Black:o.default.White,this.kind=t.slice(1)}return t.promote=function(t){return{FU:"TO",KY:"NY",KE:"NK",GI:"NG",KA:"UM",HI:"RY"}[t]||t},t.unpromote=function(t){return{TO:"FU",NY:"KY",NK:"KE",NG:"GI",KI:"KI",UM:"KA",RY:"HI",OU:"OU"}[t]||t},t.canPromote=function(r){return t.promote(r)!==r},t.isPromoted=function(t){return["TO","NY","NK","NG","UM","RY"].indexOf(t)>=0},t.oppositeColor=function(t){return t===o.default.Black?o.default.White:o.default.Black},t.fromSFENString=function(r){var e="+"===r[0];e&&(r=r.slice(1));var o=new t((r.match(/[A-Z]/)?"+":"-")+{P:"FU",L:"KY",N:"KE",S:"GI",G:"KI",B:"KA",R:"HI",K:"OU"}[r.toUpperCase()]);return e&&o.promote(),o},t.prototype.promote=function(){this.kind=t.promote(this.kind)},t.prototype.unpromote=function(){this.kind=t.unpromote(this.kind)},t.prototype.inverse=function(){this.color=this.color===o.default.Black?o.default.White:o.default.Black},t.prototype.toCSAString=function(){return(this.color===o.default.Black?"+":"-")+this.kind},t.prototype.toSFENString=function(){var r={FU:"P",KY:"L",KE:"N",GI:"S",KI:"G",KA:"B",HI:"R",OU:"K"}[t.unpromote(this.kind)];return(t.isPromoted(this.kind)?"+":"")+(this.color===o.default.Black?r:r.toLowerCase())},t}();r.default=n},function(t,r,e){"use strict";r.__esModule=!0,r.Piece=r.Color=r.Shogi=void 0;var o=e(0);r.Color=o.default;var n=e(3),i=e(1);r.Piece=i.default,e(4);var u=e(5),a=function(){function t(t){this.initialize(t)}return t.getIllegalUnpromotedRow=function(t){switch(t){case"FU":case"KY":return 1;case"KE":return 2;default:return 0}},t.getRowToOppositeEnd=function(t,r){return r===o.default.Black?t:10-t},t.prototype.initialize=function(t){void 0===t&&(t={preset:"HIRATE"}),u.fromPreset(this,t),this.flagEditMode=!1},t.prototype.initializeFromSFENString=function(t){u.fromSfen(this,t)},t.prototype.toCSAString=function(){return u.toCSA(this)},t.prototype.toSFENString=function(t){return void 0===t&&(t=1),u.toSfen(this,t)},t.prototype.editMode=function(t){this.flagEditMode=t},t.prototype.move=function(r,e,o,n,i){void 0===i&&(i=!1);var u=this.get(r,e);if(null==u)throw new Error("no piece found at "+r+", "+e);if(this.checkTurn(u.color),!this.flagEditMode&&!this.getMovesFrom(r,e).some((function(t){return t.to.x===o&&t.to.y===n})))throw new Error("cannot move from "+r+", "+e+" to "+o+", "+n);null!=this.get(o,n)&&this.capture(o,n);var a=t.getIllegalUnpromotedRow(u.kind)>=t.getRowToOppositeEnd(n,u.color);(i||a)&&u.promote(),this.set(o,n,u),this.set(r,e,null),this.nextTurn()},t.prototype.unmove=function(t,r,e,o,n,u){void 0===n&&(n=!1);var a,s=this.get(e,o);if(null==s)throw new Error("no piece found at "+e+", "+o);this.checkTurn(i.default.oppositeColor(s.color)),u&&(a=this.popFromHand(i.default.unpromote(u),s.color)).inverse();var c=this.flagEditMode;this.editMode(!0),this.move(e,o,t,r),n&&s.unpromote(),u&&(i.default.isPromoted(u)&&a.promote(),this.set(e,o,a)),this.editMode(c),this.prevTurn()},t.prototype.drop=function(t,r,e,o){if(void 0===o&&(o=this.turn),this.checkTurn(o),null!=this.get(t,r))throw new Error("there is a piece at "+t+", "+r);if(!this.getDropsBy(o).some((function(o){return o.to.x===t&&o.to.y===r&&o.kind===e})))throw new Error("Cannot move");var n=this.popFromHand(e,o);this.set(t,r,n),this.nextTurn()},t.prototype.undrop=function(t,r){var e=this.get(t,r);if(null==e)throw new Error("there is no piece at "+t+", "+r);this.checkTurn(i.default.oppositeColor(e.color)),this.pushToHand(e),this.set(t,r,null),this.prevTurn()},t.prototype.getMovesFrom=function(t,r){var e=function(t,r,e){if(t<1||9<t||r<1||9<r)return!1;var o=this.get(t,r);return null==o||o.color!==e}.bind(this),i=function(t,r,e){var o=this.get(t,r);return null!=o&&o.color!==e}.bind(this),u=this.get(t,r);if(null==u)return[];var a=n.getMoveDefinitions(u.kind),s=[],c={x:t,y:r},l=u.color===o.default.Black?1:-1;if(a.just)for(var f=0,h=a.just;f<h.length;f++){var d=h[f];e((m={x:c.x+d[0]*l,y:c.y+d[1]*l}).x,m.y,u.color)&&s.push({from:c,to:m})}if(a.fly)for(var p=0,v=a.fly;p<v.length;p++){d=v[p];for(var m={x:c.x+d[0]*l,y:c.y+d[1]*l};e(m.x,m.y,u.color)&&(s.push({from:c,to:{x:m.x,y:m.y}}),!i(m.x,m.y,u.color));)m.x+=d[0]*l,m.y+=d[1]*l}return s},t.prototype.getDropsBy=function(r){for(var e=[],o=[],n=[],i=1;i<=9;i++){for(var u=!1,a=1;a<=9;a++){var s=this.get(i,a);null==s?o.push({x:i,y:a}):s.color===r&&"FU"===s.kind&&(u=!0)}n.push(u)}for(var c={},l=0,f=this.hands[r];l<f.length;l++){var h=f[l].kind;if(!c[h]){c[h]=!0;for(var d=t.getIllegalUnpromotedRow(h),p=0,v=o;p<v.length;p++){var m=v[p];"FU"===h&&n[m.x-1]||d>=t.getRowToOppositeEnd(m.y,r)||e.push({to:m,color:r,kind:h})}}}return e},t.prototype.getMovesTo=function(t,r,e,o){void 0===o&&(o=this.turn);for(var n={x:t,y:r},i=[],u=1;u<=9;u++)for(var a=1;a<=9;a++){var s=this.get(u,a);s&&s.kind===e&&s.color===o&&this.getMovesFrom(u,a).some((function(e){return e.to.x===t&&e.to.y===r}))&&i.push({from:{x:u,y:a},to:n})}return i},t.prototype.get=function(t,r){return this.board[t-1][r-1]},t.prototype.getHandsSummary=function(t){for(var r={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0},e=0,o=this.hands[t];e<o.length;e++)r[o[e].kind]++;return r},t.prototype.captureByColor=function(t,r,e){if(!this.flagEditMode)throw new Error("cannot edit board without editMode");var o=this.get(t,r);this.set(t,r,null),o.unpromote(),o.color!==e&&o.inverse(),this.pushToHand(o)},t.prototype.flip=function(t,r){if(!this.flagEditMode)throw new Error("cannot edit board without editMode");var e=this.get(t,r);return!!e&&(i.default.isPromoted(e.kind)?(e.unpromote(),e.inverse()):i.default.canPromote(e.kind)?e.promote():e.inverse(),!0)},t.prototype.setTurn=function(t){if(!this.flagEditMode)throw new Error("cannot set turn without editMode");this.turn=t},t.prototype.set=function(t,r,e){this.board[t-1][r-1]=e},t.prototype.capture=function(t,r){var e=this.get(t,r);this.set(t,r,null),e.unpromote(),e.inverse(),this.pushToHand(e)},t.prototype.pushToHand=function(t){this.hands[t.color].push(t)},t.prototype.popFromHand=function(t,r){for(var e=this.hands[r],o=0;o<e.length;o++)if(e[o].kind===t){var n=e[o];return e.splice(o,1),n}throw new Error(r+" has no "+t)},t.prototype.nextTurn=function(){this.flagEditMode||(this.turn=this.turn===o.default.Black?o.default.White:o.default.Black)},t.prototype.prevTurn=function(){this.flagEditMode||this.nextTurn()},t.prototype.checkTurn=function(t){if(!this.flagEditMode&&t!==this.turn)throw new Error("cannot move opposite piece")},t}();r.Shogi=a},function(t,r,e){"use strict";r.__esModule=!0,r.getMoveDefinitions=void 0;var o=[0,-1],n=[0,1],i=[1,0],u=[-1,0],a=[-1,-1],s=[1,-1],c=[-1,1],l=[1,1],f={just:[a,o,s,u,i,n]},h={FU:{just:[o]},KY:{fly:[o]},KE:{just:[[-1,-2],[1,-2]]},GI:{just:[a,o,s,c,l]},KI:f,TO:f,NY:f,NK:f,NG:f,KA:{fly:[a,s,c,l]},HI:{fly:[o,u,i,n]},OU:{just:[a,o,s,u,i,c,n,l]},UM:{fly:[a,s,c,l],just:[o,u,i,n]},RY:{fly:[o,u,i,n],just:[a,s,c,l]}};r.getMoveDefinitions=function(t){return h[t]}},function(t,r,e){"use strict";r.__esModule=!0,Array.prototype.some||(Array.prototype.some=function(t){if(null==this)throw new TypeError;var r=Object(this),e=r.length>>>0;if("function"!=typeof t)throw new TypeError;for(var o=arguments[1],n=0;n<e;n++)if(n in r&&t.call(o,r[n],n,r))return!0;return!1})},function(t,r,e){"use strict";r.__esModule=!0,r.toSfen=r.fromSfen=r.toCSA=r.fromPreset=void 0;var o=e(0),n=e(6),i=e(1);r.fromPreset=function(t,r){var e,u=[],a=[[],[]];if("OTHER"!==r.preset){for(var s=n.getInitialFromPreset(r.preset),c=0;c<9;c++){u[c]=[];for(var l=0;l<9;l++){var f=s.board[l].slice(24-3*c,24-3*c+3);u[c][l]=" * "===f?null:new i.default(f)}}e=s.turn}else{for(c=0;c<9;c++)for(u[c]=[],l=0;l<9;l++){var h=r.data.board[c][l];u[c][l]=h.kind?new i.default((h.color===o.default.Black?"+":"-")+h.kind):null}e=r.data.color;for(var d=0;d<2;d++)for(var p in r.data.hands[d])if(r.data.hands[d].hasOwnProperty(p))for(f=(0===d?"+":"-")+p,c=0;c<r.data.hands[d][p];c++)a[d].push(new i.default(f))}t.board=u,t.turn=e,t.hands=a},r.toCSA=function(t){for(var r=[],e=0;e<9;e++){for(var n="P"+(e+1),i=8;i>=0;i--){var u=t.board[i][e];n+=null==u?" * ":u.toCSAString()}r.push(n)}for(var a=0;a<2;a++){n="P"+"+-"[a];for(var s=0,c=t.hands[a];s<c.length;s++)n+="00"+c[s].kind;r.push(n)}return r.push(t.turn===o.default.Black?"+":"-"),r.join("\n")},r.fromSfen=function(t,r){for(var e=[],n=0;n<9;n++){e[n]=[];for(var u=0;u<9;u++)e[n][u]=null}var a=r.split(" "),s=a[0],c=8,l=0;for(n=0;n<s.length;n++){var f=s[n];"+"===f&&(f+=s[++n]),f.match(/^[1-9]$/)?c-=Number(f):"/"===f?(l++,c=8):(e[c][l]=i.default.fromSFENString(f),c--)}t.board=e,t.turn="b"===a[1]?o.default.Black:o.default.White;var h=[[],[]],d=a[2];if("-"!==d)for(;d.length>0;){var p=1,v=d.match(/^[0-9]+/);for(v&&(p=Number(v[0]),d=d.slice(v[0].length)),n=0;n<p;n++){var m=i.default.fromSFENString(d[0]);h[m.color].push(m)}d=d.slice(1)}t.hands=h},r.toSfen=function(t,r){for(var e=[],n=[],i=0;i<9;i++){for(var u="",a=0,s=8;s>=0;s--){var c=t.board[s][i];null==c?a++:(a>0&&(u+=""+a,a=0),u+=c.toSFENString())}a>0&&(u+=""+a),n.push(u)}if(e.push(n.join("/")),e.push(t.turn===o.default.Black?"b":"w"),0===t.hands[0].length&&0===t.hands[1].length)e.push("-");else{for(var l="",f={},h=0;h<2;h++)for(var d=0,p=t.hands[h];d<p.length;d++){var v=p[d].toSFENString();f[v]=(f[v]||0)+1}for(var m=0,g=["R","B","G","S","N","L","P","r","b","g","s","n","l","p"];m<g.length;m++){var A=g[m];f[A]>0&&(l+=(f[A]>1?f[A]:"")+A)}e.push(l)}return e.push(""+r),e.join(" ")}},function(t,r,e){"use strict";r.__esModule=!0,r.getInitialFromPreset=void 0;var o=e(0),n=" *  *  *  *  *  *  *  *  * ",i=["-FU-FU-FU-FU-FU-FU-FU-FU-FU",n,n,n,"+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],u=[n].concat(i),a={HIRATE:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  * -KA * "].concat(i),turn:o.default.Black},KY:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "," * -HI *  *  *  *  * -KA * "].concat(i),turn:o.default.White},KY_R:{board:[" * -KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  * -KA * "].concat(i),turn:o.default.White},KA:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  *  *  * "].concat(i),turn:o.default.White},HI:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," *  *  *  *  *  *  * -KA * "].concat(i),turn:o.default.White},HIKY:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "," *  *  *  *  *  *  * -KA * "].concat(i),turn:o.default.White},2:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"].concat(u),turn:o.default.White},3:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "].concat(u),turn:o.default.White},4:{board:[" * -KE-GI-KI-OU-KI-GI-KE * "].concat(u),turn:o.default.White},5:{board:[" *  * -GI-KI-OU-KI-GI-KE * "].concat(u),turn:o.default.White},"5_L":{board:[" * -KE-GI-KI-OU-KI-GI *  * "].concat(u),turn:o.default.White},6:{board:[" *  * -GI-KI-OU-KI-GI *  * "].concat(u),turn:o.default.White},"7_R":{board:[" *  *  * -KI-OU-KI-GI *  * "].concat(u),turn:o.default.White},"7_L":{board:[" *  * -GI-KI-OU-KI *  *  * "].concat(u),turn:o.default.White},8:{board:[" *  *  * -KI-OU-KI *  *  * "].concat(u),turn:o.default.White},10:{board:[" *  *  *  * -OU *  *  *  * "].concat(u),turn:o.default.White}};r.getInitialFromPreset=function(t){var r=a[t];if(!r)throw new Error("Unknown preset: "+t);return r};var s=Object.keys(a);r.default=s}])},846:(t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},694:(t,r,e)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=e(886),n=e(603),i=e(222),u=function(){function t(t){this.forkPointers=[],this.forks_=null,this.currentStream_=null,this.shogi=new o.Shogi(t.initial||void 0),this.initialize(t)}return t.log=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];t.debug?console.log(r):t.logs.push(r)},t.parse=function(r,e){if(e){var o=e.split(".");switch(o[o.length-1].toLowerCase()){case"jkf":return t.parseJKF(r);case"kif":case"kifu":return t.parseKIF(r);case"ki2":case"ki2u":return t.parseKI2(r);case"csa":return t.parseCSA(r)}}try{return t.parseJKF(r)}catch(r){t.log("failed to parse as jkf",r)}try{return t.parseKIF(r)}catch(r){t.log("failed to parse as kif",r)}try{return t.parseKI2(r)}catch(r){t.log("failed to parse as ki2",r)}try{return t.parseCSA(r)}catch(r){t.log("failed to parse as csa",r)}throw new Error("JKF, KIF, KI2, CSAいずれの形式でも失敗しました")},t.parseJKF=function(r){return t.log("parseJKF",r),new t(JSON.parse(r))},t.parseKIF=function(r){return t.log("parseKIF",r),new t(n.normalizeKIF(i.parseKIF(t.addLastNewLine(r))))},t.parseKI2=function(r){return t.log("parseKI2",r),new t(n.normalizeKI2(i.parseKI2(t.addLastNewLine(r))))},t.parseCSA=function(r){return t.log("parseCSA",r),new t(n.normalizeCSA(i.parseCSA(t.addLastNewLine(r))))},t.addLastNewLine=function(t){return"\n"===t.substr(t.length-1)?t:t+"\n"},t.numToZen=function(t){return"０１２３４５６７８９"[t]},t.numToKan=function(t){return"〇一二三四五六七八九"[t]},t.kindToKan=function(t){return{FU:"歩",KY:"香",KE:"桂",GI:"銀",KI:"金",KA:"角",HI:"飛",OU:"玉",TO:"と",NY:"成香",NK:"成桂",NG:"成銀",UM:"馬",RY:"龍"}[t]},t.relativeToKan=function(t){return{L:"左",C:"直",R:"右",U:"上",M:"寄",D:"引",H:"打"}[t]},t.specialToKan=function(t){return{TORYO:"投了",CHUDAN:"中断",SENNICHITE:"千日手",TIME_UP:"時間切れ",ILLEGAL_MOVE:"反則負け","+ILLEGAL_ACTION":"後手反則負け","-ILLEGAL_ACTION":"先手反則負け",JISHOGI:"持将棋",KACHI:"勝ち宣言",HIKIWAKE:"引き分け宣言",MATTA:"待った",TSUMI:"詰",FUZUMI:"不詰",ERROR:"エラー"}[t]||t},t.moveToReadableKifu=function(r){if(r.special)return t.specialToKan(r.special);var e=r.move,n=e.color===o.Color.Black?"☗":"☖";return e.same?n+="同　":n+=t.numToZen(e.to.x)+t.numToKan(e.to.y),n+=t.kindToKan(e.piece),e.relative&&(n+=e.relative.split("").map(t.relativeToKan).join("")),null!=e.promote&&(n+=e.promote?"成":"不成"),n},t.doMove=function(t,r){r&&(r.from?t.move(r.from.x,r.from.y,r.to.x,r.to.y,r.promote):t.drop(r.to.x,r.to.y,r.piece,void 0!==r.color?r.color:void 0))},t.undoMove=function(t,r){r&&(r.from?t.unmove(r.from.x,r.from.y,r.to.x,r.to.y,r.promote,r.capture):t.undrop(r.to.x,r.to.y))},t.getState=function(r){return{board:t.getBoardState(r),color:r.turn,hands:t.getHandsState(r)}},t.sameMoveMinimal=function(t,r){return t.to.x===r.to.x&&t.to.y===r.to.y&&(t.from&&r.from?t.from.x===r.from.x&&t.from.y===r.from.y&&t.promote===r.promote:t.piece===r.piece)},t.getBoardState=function(t){for(var r=[],e=1;e<=9;e++){for(var o=[],n=1;n<=9;n++){var i=t.get(e,n);o.push(i?{color:i.color,kind:i.kind}:{})}r.push(o)}return r},t.getHandsState=function(t){return[t.getHandsSummary(o.Color.Black),t.getHandsSummary(o.Color.White)]},Object.defineProperty(t.prototype,"forks",{get:function(){return null===this.forks_&&this.updateForksAndCurrentStream(),this.forks_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentStream",{get:function(){return null===this.currentStream_&&this.updateForksAndCurrentStream(),this.currentStream_},enumerable:!1,configurable:!0}),t.prototype.initialize=function(t){this.kifu=t,this.tesuu=0,this.forkPointers=[]},t.prototype.forward=function(){var r=this.getMoveFormat(this.tesuu+1);if(!r)return!1;this.tesuu++;var e=r.move;return!e||(t.log("forward",this.tesuu,e),this.doMove(e),!0)},t.prototype.backward=function(){var r=this;if(this.tesuu<=0)return!1;var e=this.getMoveFormat(this.tesuu).move;return t.log("backward",this.tesuu-1,e),this.undoMove(e),this.tesuu--,this.forkPointers=this.forkPointers.filter((function(t){return t.te<=r.tesuu})),this.updateForksAndCurrentStream(),!0},t.prototype.goto=function(t){if("string"==typeof t){var r=t.indexOf(",");if(r>0){for(var e=Number(t.slice(0,r)),o=JSON.parse(t.slice(r+1)),n=!0,i=0;i<o.length;i++){var u=o[i],a=this.forkPointers[i];n&&a&&a.te===u.te&&a.forkIndex===u.forkIndex||(n=!1,this.goto(u.te-1),this.forkAndForward(u.forkIndex))}return n&&o.length<this.forkPointers.length&&this.goto(this.forkPointers[o.length].te-1),void this.goto(e)}t=Number(t)}if(!isNaN(t)){var s=1e4;if(this.tesuu<t)for(;this.tesuu!==t&&this.forward()&&s-- >0;);else for(;this.tesuu!==t&&this.backward()&&s-- >0;);if(0===s)throw new Error("tesuu overflows")}},t.prototype.go=function(t){"string"==typeof t&&(t=Number(t)),isNaN(t)||this.goto(this.tesuu+t)},t.prototype.forkAndForward=function(t){"string"==typeof t&&(t=parseInt(t,10));var r=this.getMoveFormat(this.tesuu+1).forks;return!(!r||r.length<=t)&&(this.forkPointers.push({te:this.tesuu+1,forkIndex:t}),this.updateForksAndCurrentStream(),this.forward())},t.prototype.getTesuuPointer=function(t){return isNaN(t)&&(t=this.tesuu),t+","+JSON.stringify(this.forkPointers.filter((function(r){return r.te<=t})))},t.prototype.inputMove=function(r){if(this.getMoveFormat().special)throw new Error("終了局面へ棋譜を追加することは出来ません");if(null!=r.from&&null==r.promote){var e=this.shogi.get(r.from.x,r.from.y);if(!o.Piece.isPromoted(e.kind)&&o.Piece.canPromote(e.kind)&&(n.canPromote(r.from,e.color)||n.canPromote(r.to,e.color)))return!1}var i=this.getMoveFormat(this.tesuu+1);if(i){if(i.move&&t.sameMoveMinimal(i.move,r))return this.forward(),!0;if(i.forks)for(var u=0;u<i.forks.length;u++){var a=i.forks[u][0];if(a&&a.move&&t.sameMoveMinimal(a.move,r))return this.forkAndForward(u),!0}}this.doMove(r);var s,c={move:r},l=this.tesuu<this.getMaxTesuu();return l?((s=this.getMoveFormat(this.tesuu+1)).forks||(s.forks=[]),s.forks.push([c])):this.forks[this.forks.length-1].moves.push(c),this.updateForksAndCurrentStream(),n.normalizeMinimal(this.kifu),this.undoMove(r),l?this.forkAndForward(s.forks.length-1):this.forward(),!0},t.prototype.getBoard=function(t,r){return this.shogi.get(t,r)},t.prototype.getComments=function(t){return void 0===t&&(t=this.tesuu),this.getMoveFormat(t).comments||[]},t.prototype.getMove=function(t){return void 0===t&&(t=this.tesuu),this.getMoveFormat(t).move},t.prototype.getReadableKifu=function(r){return void 0===r&&(r=this.tesuu),0===r?"開始局面":t.moveToReadableKifu(this.getMoveFormat(r))},t.prototype.getReadableForkKifu=function(r){return void 0===r&&(r=this.tesuu),this.getNextFork(r).map((function(r){return t.moveToReadableKifu(r[0])}))},t.prototype.getMaxTesuu=function(){return this.currentStream.length-1},t.prototype.toJKF=function(){return JSON.stringify(this.kifu)},t.prototype.getState=function(){return t.getState(this.shogi)},t.prototype.getReadableKifuState=function(){for(var t=[],r=0;r<=this.getMaxTesuu();r++)t.push({comments:this.getComments(r),forks:this.getReadableForkKifu(r-1),kifu:this.getReadableKifu(r)});return t},t.prototype.updateForksAndCurrentStream=function(){for(var t=[],r=[],e=this.kifu.moves,o=0,n=0,i=this.forkPointers;n<i.length;n++){var u=i[n];t.push({te:o,moves:e}),r=r.concat(e.slice(0,u.te-o)),e=e[u.te-o].forks[u.forkIndex],o=u.te}t.push({te:o,moves:e}),this.forks_=t,this.currentStream_=r.concat(e.slice())},t.prototype.getMoveFormat=function(t){return void 0===t&&(t=this.tesuu),this.currentStream[t]},t.prototype.getNextFork=function(t){void 0===t&&(t=this.tesuu);var r=this.getMoveFormat(t+1);return r&&r.forks?r.forks:[]},t.prototype.doMove=function(r){t.doMove(this.shogi,r)},t.prototype.undoMove=function(r){t.undoMove(this.shogi,r)},t.debug=!1,t.logs=[],t}();r.default=u},603:(t,r,e)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterMovesByRelatives=r.addRelativeInformation=r.normalizeCSA=r.normalizeKI2=r.normalizeKIF=r.normalizeMinimal=r.canPromote=void 0;var o=e(886);function n(t,r){return r===o.Color.Black?t.y<=3:t.y>=7}function i(t,r,e){for(var u=0;u<r.length;u++){var a=0===u?e:r[u-1];if(l=r[u].move)if(l.color=t.turn,l.from){a&&a.move&&l.to.x===a.move.to.x&&l.to.y===a.move.to.y&&(l.same=!0),c(t,l),l.piece||(l.piece=t.get(l.from.x,l.from.y).kind),l.promote||o.Piece.isPromoted(l.piece)||!o.Piece.canPromote(l.piece)||(n(l.to,t.turn)||n(l.from,t.turn))&&(l.promote=!1),s(t,l);try{t.move(l.from.x,l.from.y,l.to.x,l.to.y,l.promote)}catch(t){throw new Error(u+"手目で失敗しました: "+t)}}else t.getMovesTo(l.to.x,l.to.y,l.piece).length>0&&(l.relative="H"),t.drop(l.to.x,l.to.y,l.piece)}for(m(r,t),u=r.length-1;u>=0;u--){var l;if((l=r[u].move)&&(l.from?t.unmove(l.from.x,l.from.y,l.to.x,l.to.y,l.promote,l.capture):t.undrop(l.to.x,l.to.y)),a=u<=1?e:r[u-1],r[u].forks)for(var f=0,h=r[u].forks;f<h.length;f++)i(t,h[f],a)}}function u(t,r,e){for(var i=0;i<r.length;i++){var a=0===i?e:r[i-1];if(l=r[i].move)if(l.color=t.turn,l.from){l.same&&(l.to=a.move.to),c(t,l),l.promote||o.Piece.isPromoted(l.piece)||!o.Piece.canPromote(l.piece)||(n(l.to,t.turn)||n(l.from,t.turn))&&(l.promote=!1),s(t,l);try{t.move(l.from.x,l.from.y,l.to.x,l.to.y,l.promote)}catch(t){throw new Error(i+"手目で失敗しました: "+t)}}else t.getMovesTo(l.to.x,l.to.y,l.piece).length>0&&(l.relative="H"),t.drop(l.to.x,l.to.y,l.piece)}for(m(r,t),i=r.length-1;i>=0;i--){var l;if((l=r[i].move)&&(l.from?t.unmove(l.from.x,l.from.y,l.to.x,l.to.y,l.promote,l.capture):t.undrop(l.to.x,l.to.y)),a=0===i?e:r[i-1],r[i].forks)for(var f=0,h=r[i].forks;f<h.length;f++)u(t,h[f],a)}}function a(t,r,e){for(var o=0;o<r.length;o++){var n=0===o?e:r[o-1];if(s=r[o].move){s.color=t.turn,s.same&&(s.to=n.move.to);var i=t.getMovesTo(s.to.x,s.to.y,s.piece);if("H"===s.relative||0===i.length);else if(1===i.length)s.from=i[0].from;else{var u=v(s.relative,t.turn,i);if(1!==u.length)throw new Error("相対情報が不完全で複数の候補があります");s.from=u[0].from}if(s.from){c(t,s);try{t.move(s.from.x,s.from.y,s.to.x,s.to.y,s.promote)}catch(t){throw new Error(o+"手目で失敗しました: "+t)}}else t.drop(s.to.x,s.to.y,s.piece)}}for(m(r,t),o=r.length-1;o>=0;o--){var s;if((s=r[o].move)&&(s.from?t.unmove(s.from.x,s.from.y,s.to.x,s.to.y,s.promote,s.capture):t.undrop(s.to.x,s.to.y),n=o<=1?e:r[o-1],r[o].forks))for(var l=0,f=r[o].forks;l<f.length;l++)a(t,f[l],n)}}function s(t,r){var e=t.getMovesTo(r.to.x,r.to.y,r.piece).map((function(r){return l(t.turn,h(r.to,r.from))}));if(e.length>=2){var o=l(t.turn,h(r.to,r.from));r.relative=1===e.filter((function(t){return t.y===o.y})).length?d(o.y):1===e.filter((function(t){return t.x===o.x})).length?"UM"!==r.piece&&"RY"!==r.piece||0!==o.x?p(o.x):p(0===e.filter((function(t){return t.x<0})).length?-1:1):0===o.x?p(o.x):p(o.x)+d(o.y)}}function c(t,r){var e=t.get(r.to.x,r.to.y);e&&(r.capture=e.kind)}function l(t,r){return t===o.Color.Black?r:{x:-r.x,y:-r.y}}function f(t,r){return t===r?0:t>r?1:-1}function h(t,r){return{x:f(t.x,r.x),y:f(t.y,r.y)}}function d(t){return 0===t?"M":t>0?"D":"U"}function p(t){return 0===t?"C":t>0?"R":"L"}function v(t,r,e){var o=e.map((function(t){return{move:t,vec:l(r,{x:t.to.x-t.from.x,y:t.to.y-t.from.y})}})).filter((function(r){r.move;var e=r.vec;return t.split("").every((function(t){return function(t,r,e){switch(t){case"U":return e.y<0;case"M":return 0===e.y;case"D":return e.y>0;case"C":return 0===e.x;case"L":case"R":return!0}}(t,0,e)}))}));if(t.indexOf("C")>=0&&(o=o.filter((function(t){return t.move,t.vec.y<0}))),t.indexOf("L")>=0){var n=1/0;return o.forEach((function(t){t.move;var r=t.vec;return n=Math.min(n,r.x)})),o.filter((function(t){return t.move,t.vec.x===n})).map((function(t){var r=t.move;return t.vec,r}))}if(t.indexOf("R")>=0){var i=-1/0;return o.forEach((function(t){t.move;var r=t.vec;return i=Math.max(i,r.x)})),o.filter((function(t){return t.move,t.vec.x===i})).map((function(t){var r=t.move;return t.vec,r}))}return o.map((function(t){var r=t.move;return t.vec,r}))}function m(t,r){t.length>=1&&"ILLEGAL_ACTION"===t[t.length-1].special&&(t[t.length-1].special=(r.turn?"+":"-")+"ILLEGAL_ACTION")}r.canPromote=n,r.normalizeMinimal=function(t){return i(new o.Shogi(t.initial),t.moves),t},r.normalizeKIF=function(t){return t.initial&&"HIRATE"===t.initial.preset&&t.initial.data&&(t.initial.preset="OTHER"),u(new o.Shogi(t.initial||void 0),t.moves),t},r.normalizeKI2=function(t){return a(new o.Shogi(t.initial||void 0),t.moves),t},r.normalizeCSA=function(t){!function(t){if(t.initial&&"OTHER"===t.initial.preset){for(var r=["FU","KY","KE","GI","KI","KA","HI"],e=0;e<2;e++)for(var n=0,i=r;n<i.length;n++){var u=i[n];if(0!==t.initial.data.hands[e][u])return}var a,s,c=[[{color:o.Color.White,kind:"KY"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"KY"}],[{color:o.Color.White,kind:"KE"},{color:o.Color.White,kind:"KA"},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{color:o.Color.Black,kind:"HI"},{color:o.Color.Black,kind:"KE"}],[{color:o.Color.White,kind:"GI"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"GI"}],[{color:o.Color.White,kind:"KI"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"KI"}],[{color:o.Color.White,kind:"OU"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"OU"}],[{color:o.Color.White,kind:"KI"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"KI"}],[{color:o.Color.White,kind:"GI"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"GI"}],[{color:o.Color.White,kind:"KE"},{color:o.Color.White,kind:"HI"},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{color:o.Color.Black,kind:"KA"},{color:o.Color.Black,kind:"KE"}],[{color:o.Color.White,kind:"KY"},{},{color:o.Color.White,kind:"FU"},{},{},{},{color:o.Color.Black,kind:"FU"},{},{color:o.Color.Black,kind:"KY"}]],l=[];for(e=0;e<9;e++)for(var f=0;f<9;f++)a=t.initial.data.board[e][f],s=c[e][f],void 0===a.color&&void 0===s.color||void 0!==a.color&&void 0!==s.color&&a.color===s.color&&a.kind===s.kind||l.push(""+(e+1)+(f+1));var h={"":"HIRATE"};h[11]="KY",h[91]="KY_R",h[22]="KA",h[82]="HI",h[1182]="HIKY",h[2282]="2",h[228291]="3",h[11228291]="4",h[1122818291]="5",h[1121228291]="5_L",h[112122818291]="6",h[0xa328d183c33]="7_L",h[0xa328f7a9633]="7_R",h[0x3fbbf1cdec333]="8",h["11212231416171818291"]="10";var d=h[l.sort().join("")];"HIRATE"===d?t.initial.data.color===o.Color.Black&&(t.initial.preset="HIRATE",delete t.initial.data):d&&t.initial.data.color===o.Color.White&&(t.initial.preset=d,delete t.initial.data)}}(t);for(var r=new o.Shogi(t.initial||void 0),e=0;e<t.moves.length;e++){a=t.moves[e].time,void 0===(l=e>=2?t.moves[e-2].time:void 0)&&(l={now:{m:0,s:0},total:{h:0,m:0,s:0}}),a&&(a.total={h:(a.now.h||0)+l.total.h,m:a.now.m+l.total.m,s:a.now.s+l.total.s},a.total.m+=Math.floor(a.total.s/60),a.total.s=a.total.s%60,a.total.h+=Math.floor(a.total.m/60),a.total.m=a.total.m%60);var i=t.moves[e].move;if(i)if(i.color=r.turn,i.from){if(e>0&&t.moves[e-1].move&&t.moves[e-1].move.to.x===i.to.x&&t.moves[e-1].move.to.y===i.to.y&&(i.same=!0),c(r,i),o.Piece.isPromoted(i.piece)){var u=r.get(i.from.x,i.from.y);u.kind!==i.piece&&(i.piece=u.kind,i.promote=!0)}else o.Piece.canPromote(i.piece)&&(n(i.to,r.turn)||n(i.from,r.turn))&&(i.promote=!1);s(r,i);try{r.move(i.from.x,i.from.y,i.to.x,i.to.y,i.promote)}catch(t){throw new Error(e+"手目で失敗しました: "+t)}}else r.getMovesTo(i.to.x,i.to.y,i.piece).length>0&&(i.relative="H"),r.drop(i.to.x,i.to.y,i.piece)}var a,l;return t},r.addRelativeInformation=s,r.filterMovesByRelatives=v},728:()=>{},222:(t,r,e)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parseKI2=r.parseKIF=r.parseCSA=void 0,e(728);var o=e(405),n=e(478),i=e(516);r.parseCSA=function(t){return o.parse(t)},r.parseKIF=function(t){return i.parse(t)},r.parseKI2=function(t){return n.parse(t)}}},r={};function e(o){var n=r[o];if(void 0!==n)return n.exports;var i=r[o]={exports:{}};return t[o](i,i.exports,e),i.exports}var o={};(()=>{"use strict";var t=o;Object.defineProperty(t,"__esModule",{value:!0}),t.Formats=t.Parsers=t.JKFPlayer=t.Normalizer=void 0;var r=e(846);t.Formats=r;var n=e(694);t.JKFPlayer=n.default;var i=e(603);t.Normalizer=i;var u=e(222);t.Parsers=u})(),JSONKifuFormat=o})();